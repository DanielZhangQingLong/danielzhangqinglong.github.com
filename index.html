<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  




<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
<meta name="twitter:description">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> Hexo </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Hexo</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="#" class="st-search-show-outputs">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <form class="site-search-form">
  <input type="text" id="st-search-input" class="st-search-input st-default-search-input" />
</form>

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', 'uSvyVbAJs-5jfXFawgQ3','2.0.0');
</script>



    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/01/24/single-responsibility/" itemprop="url">
                  设计具有单一职责的类
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-01-24T21:50:02+08:00" content="2016-01-24">
              2016-01-24
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/OO-Design/" itemprop="url" rel="index">
                    <span itemprop="name">OO-Design</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/01/24/single-responsibility/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/01/24/single-responsibility/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h2><blockquote>
<p>最近在读Sandi Metz 的&lt;&lt;面向对象设计实践指南&gt;&gt;这本书, 我是通过ruby conf 演讲才知道作者的, 我记得她在完全不了解一大坨<code>if else</code> 在做什么事情的情况下, 将其重构成了一些优雅的小的对象和方法, 很精彩的一个演讲. 写这篇文章的目的是我对本书第二章的一个总结. 单一原则的核心思想是:  一个类应该尽可能做最小用途的事情, 一个方法也只应该做一件事情.</p>
<p>这一章使用自行车和齿轮来作为例子来说明这个道理, 自行车可以拆解成为一个个小的零件, 齿轮, 车轮等等, 这些可以理解成类, 还有一些属性如齿轮牙数, 齿轮牙数比率, 车轮周长, 直径等, 这些可以理解成方法.</p>
</blockquote>
<h2 id="为什么单一职责重要"><a href="#为什么单一职责重要" class="headerlink" title="为什么单一职责重要"></a>为什么单一职责重要</h2><blockquote>
<p>为何单一职责原则很重要? 这是因为易于更改的应用程序由易于复用的类构成, 如果一个类或者一个方法有很多用途, 很多功能在里面纠缠不清, 而使用的人只看重其中某个功能, 这样很难去使用已有的代码, 而再去实现又会冗余.</p>
<p>如何确立一个类是否具有单一职责? 有一个简单的方法是用一句话来描述它, 比如”齿轮的英寸数是…” 如果使用了<code>和</code>或者<code>或</code>, 那么就不属于单一职责的类.</p>
</blockquote>
<h2 id="编写拥抱变化的代码"><a href="#编写拥抱变化的代码" class="headerlink" title="编写拥抱变化的代码"></a>编写拥抱变化的代码</h2><blockquote>
<p>记住一点: 类的实例变量永远要通过方法来获取, 也就是通常说的getter方法, ruby 中是attr_reader .</p>
<p>隐藏数据结构: 如果实例变量依赖一个数据结构(如二维数组), 我们需要这种混乱的结构隐藏起来, 暴露的数据应该是简单的结构(类的对象).</p>
</blockquote>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/07/01/angular02/" itemprop="url">
                  angular02
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-07-01T09:09:02+08:00" content="2015-07-01">
              2015-07-01
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/07/01/angular02/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/07/01/angular02/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>AngularJS 使用表达式把数据绑定给html.<br>AngularJS 表达式写在  双花括号中.<br>AngularJS 表达式把数据绑定给html的方式和<code>ng-bind</code> 指令是一样的.<br>AngularJS 将会在表达式的地方输出数据.<br>AngularJS 表达式更像是JavaScript 表达式. 包含字符串, 操作符和变量. 如<code>10 or undefined undefined</code></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;script src=&quot;http://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;div ng-app=&quot;&quot;&gt;</span><br><span class="line">  &lt;p&gt;My first expression: &#123;&#123; 5 + 5  &#125;&#125;&lt;/p&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">  &lt;/html&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意: 如果移除了 <code>ng-app</code> 指令, 那么表达式是不会解析的.</p>
</blockquote>
<h2 id="AngularJS-Numbers"><a href="#AngularJS-Numbers" class="headerlink" title="AngularJS Numbers"></a>AngularJS Numbers</h2><blockquote>
<p>AngularJS 数字像JavaScript 数字.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-app=&quot;&quot; ng-init=&apos;quantity=2; cost=5&apos;&gt;</span><br><span class="line">  &lt;p&gt;Total in dollar: &#123;&#123; quantity * cost &#125;&#125;&lt;/p&gt;</span><br><span class="line">  </span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>同使用<code>ng-bind</code>指令是一样的:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-app=&apos;&apos; ng-init=&apos;quantit=1;cost=5&apos;&gt;</span><br><span class="line">  &lt;p&gt;Total in dollar: &lt;span ng-bind=&apos;quantit * cost&apos;&gt;&lt;/span&gt;&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h2 id="AngularJS-Strings"><a href="#AngularJS-Strings" class="headerlink" title="AngularJS Strings"></a>AngularJS Strings</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-app=&quot;&quot; ng-init=&quot;firstName=&apos;John&apos;;lastName=&apos;Doe&apos;&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;The name is &#123;&#123; firstName + &quot; &quot; + lastName  &#125;&#125;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h2 id="AngularJS-Objects"><a href="#AngularJS-Objects" class="headerlink" title="AngularJS Objects"></a>AngularJS Objects</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-app=&apos;&apos; ng-init=&quot;person=&#123;firtName: &apos;John&apos;, lastName: &apos;Doe&apos;&#125;&quot;&gt;</span><br><span class="line">  &lt;p&gt;The name is &#123;&#123; person.lastName &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h2 id="AngularJS-Arrays"><a href="#AngularJS-Arrays" class="headerlink" title="AngularJS Arrays"></a>AngularJS Arrays</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-app=&apos;&apos; ng-init=&quot;points=[1, 3, 5, 7]&quot;&gt;</span><br><span class="line">  &lt;p&gt;The third result is &#123;&#123; points[2] &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/06/23/angular01/" itemprop="url">
                  angular01
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-06-23T08:27:20+08:00" content="2015-06-23">
              2015-06-23
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/06/23/angular01/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/06/23/angular01/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>Angular 是一个Javascript的框架,它可以通过使用script标签添加到HTML上, 它通过指令扩展HTML属性, 通过表达式给HTML绑定数据.</p>
</blockquote>
<h2 id="AngularJS-是JS的框架"><a href="#AngularJS-是JS的框架" class="headerlink" title="AngularJS 是JS的框架"></a>AngularJS 是JS的框架</h2><blockquote>
<p>AngularJS 是用Javascript写成的库. 它以JavaScript文件的形式发布, 可以通过script标签添加到web页面上.</p>
</blockquote>
<h2 id="AngularJS-扩展HTML"><a href="#AngularJS-扩展HTML" class="headerlink" title="AngularJS 扩展HTML"></a>AngularJS 扩展HTML</h2><blockquote>
<p>AngularJS通过<code>ng-directives</code> 扩展HTML.</p>
<ul>
<li><code>ng-app</code>定义AngularJS应用</li>
<li><code>ng-model</code>给应用数据绑定HTML控制元素的值.</li>
<li><code>ng-bind</code>给HTML视图绑定应用数据.</li>
</ul>
</blockquote>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;script src=&quot;http://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;div ng-app=&apos;&apos;&gt;  </span><br><span class="line">      &lt;p&gt;Name : &lt;input type=&quot;text&quot; name=&quot;&quot; id=&quot;&quot; value=&quot;&quot; ng-model=&apos;name&apos;/&gt;&lt;/p&gt;</span><br><span class="line">      &lt;p ng-bind=&apos;name&apos;&gt;&lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</code></pre><blockquote>
<p>AngularJS 在页面加载完成后会运行.</p>
</blockquote>
<ul>
<li><code>ng-app</code>指令告诉AngularJS <code>div</code>元素是AngularJS应用的拥有者.</li>
<li><code>ng-model</code>指令将<code>input</code>中输入的值绑定到变量<code>name</code>上.</li>
<li><code>ng-bind</code>指令把<code>name</code>的值绑定到<code>p</code>元素的<code>innerHTML</code>上.</li>
</ul>
<h2 id="AngularJS-指令"><a href="#AngularJS-指令" class="headerlink" title="AngularJS 指令"></a>AngularJS 指令</h2><blockquote>
<p>从前面的例子不难看出, <code>ng-init</code> AngularJS的指令是带有一个<code>ng</code>前缀的HTML属性.<br><code>ng-init</code>指令用来初始化AngularJS 应用的变量.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;script src=&quot;http://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;div ng-app=&apos;&apos; ng-init=&quot;firstName=&apos;John&apos;&quot;&gt;  </span><br><span class="line">      &lt;p&gt;The name is &lt;span ng-bind=&quot;firstName&quot;&gt;&lt;/span&gt;&lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>也可以像下面这样写:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div data-ng-app=&quot;&quot; data-ng-init=&quot;firstName=&apos;John&apos;&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;The name is &lt;span data-ng-bind=&quot;firstName&quot;&gt;&lt;/span&gt;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>下面这样写可以是变量在页面范围内有效.</p>
</blockquote>
<h2 id="AngularJS表达式"><a href="#AngularJS表达式" class="headerlink" title="AngularJS表达式"></a>AngularJS表达式</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    </span><br><span class="line">      &lt;script src=&apos;http://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js&apos;&gt;&lt;/script&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width&quot;&gt;</span><br><span class="line">    &lt;title&gt;&lt;/title&gt;</span><br><span class="line">    link</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;div ng-app=&apos;&apos;&gt;</span><br><span class="line">      &lt;p&gt;My first expression: &#123;&#123; 5+5 &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;div ng-app=&apos;&apos;&gt;</span><br><span class="line">    &lt;p&gt;Name: &lt;input type=&quot;text&quot; ng-model=&apos;name&apos;&gt; &lt;/p&gt;</span><br><span class="line">    &lt;p&gt;&#123;&#123;name&#125;&#125;&lt;/p&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<h2 id="AngularJS-应用"><a href="#AngularJS-应用" class="headerlink" title="AngularJS 应用"></a>AngularJS 应用</h2><blockquote>
<p>AngularJS modules 定义 AngularJS 应用. AngularJS controllers 控制AngularJS 应用. <code>ng-app</code> 指令定义应用, <code>ng-controller</code>指令定义controller.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">  &lt;div ng-app=&apos;myApp&apos; ng-controller=&apos;myCtrl&apos;&gt;</span><br><span class="line">    First Name: &lt;input type=&quot;text&quot; ng-model=&apos;firstName&apos;&gt; &lt;br /&gt;</span><br><span class="line">    Last Name: &lt;input type=&quot;text&quot; ng-model=&apos;lastName&apos;&gt; &lt;br /&gt;</span><br><span class="line">    &lt;br /&gt;</span><br><span class="line">    Full Name: &#123;&#123; firstName + &quot; &quot; + lastName &#125;&#125;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">  &lt;script type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;</span><br><span class="line">    var app = angular.module(&apos;myApp&apos;, []);</span><br><span class="line">    app.controller(&apos;myCtrl&apos;, function($scope) &#123;</span><br><span class="line">        $scope.firstName=&apos;John&apos;;</span><br><span class="line">        $scope.lastName=&apos;Doe&apos;;</span><br><span class="line">        &#125;);</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/04/16/jquery3/" itemprop="url">
                  jQuery Review 3
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-04-16T09:42:34+08:00" content="2015-04-16">
              2015-04-16
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/JavaScript/" itemprop="url" rel="index">
                    <span itemprop="name">JavaScript</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/04/16/jquery3/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/04/16/jquery3/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>jQuery 可以减少使用AJAX的痛苦.</p>
</blockquote>
<h2 id="jQuery-AJAX-load-方法"><a href="#jQuery-AJAX-load-方法" class="headerlink" title="jQuery - AJAX load() 方法"></a>jQuery - AJAX load() 方法</h2><blockquote>
<p>语法:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(selector).load(URL,data,callback);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>必需的 URL 参数规定您希望加载的 URL。<br>可选的 data 参数规定与请求一同发送的查询字符串键/值对集合。<br>可选的 callback 参数是 load() 方法完成后所执行的函数名称。</p>
<p>可选的 callback 参数规定当 load() 方法完成后所要允许的回调函数。回调函数可以设置不同的参数：<br>responseTxt - 包含调用成功时的结果内容<br>statusTXT - 包含调用的状态<br>xhr - 包含 XMLHttpRequest 对象</p>
<p>下面的例子会在 load() 方法完成后显示一个提示框。如果 load() 方法已成功，则显示“外部内容加载成功！”，而如果失败，则显示错误消息：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$(&quot;button&quot;).click(function()&#123;</span><br><span class="line">$(&quot;#div1&quot;).load(&quot;demo_test.txt&quot;,function(responseTxTxt,xhr)&#123;</span><br><span class="line">    if(statusTxt==&quot;success&quot;)</span><br><span class="line">      alert(&quot;外部内容加载成功！&quot;);</span><br><span class="line">      if(statusTxt==&quot;error&quot;)</span><br><span class="line">      alert(&quot;Error: &quot;+xhr.status+&quot;: &quot;+xhr.statusText);</span><br><span class="line">                   </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="jQuery-AJAX-get-和-post-方法"><a href="#jQuery-AJAX-get-和-post-方法" class="headerlink" title="jQuery - AJAX get() 和 post() 方法"></a>jQuery - AJAX get() 和 post() 方法</h2><blockquote>
<p>HTTP 请求：GET vs. POST<br>两种在客户端和服务器端进行请求-响应的常用方法是：GET 和 POST。<br>GET - 从指定的资源请求数据<br>POST - 向指定的资源提交要处理的数据<br>GET 基本上用于从服务器获得（取回）数据。注释：GET 方法可能返回缓存数据。<br>POST 也可用于从服务器获取数据。不过，POST 方法不会缓存数据，并且常用于连同请求一起发送数据。</p>
</blockquote>
<h3 id="jQuery-get-方法"><a href="#jQuery-get-方法" class="headerlink" title="jQuery $.get() 方法"></a>jQuery $.get() 方法</h3><blockquote>
<p>$.get() 方法通过 HTTP GET 请求从服务器上请求数据。语法:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.get(URL,callback);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>例如:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$(&quot;button&quot;).click(function()&#123;</span><br><span class="line">$.get(&quot;demo_test.asp&quot;,function(dat)&#123;</span><br><span class="line">    alert(&quot;Data: &quot; + data + &quot;\nStatus: &quot; + status);</span><br><span class="line">      </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="jQuery-post-方法"><a href="#jQuery-post-方法" class="headerlink" title="jQuery $.post() 方法"></a>jQuery $.post() 方法</h3><blockquote>
<p>$.post() 方法通过 HTTP POST 请求从服务器上请求数据。<br>语法：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.post(URL,data,callback);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>例如:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$(&quot;button&quot;).click(function()&#123;</span><br><span class="line">  $.post(&quot;demo_test_post.asp&quot;,</span><br><span class="line">  &#123;</span><br><span class="line">      name:&quot;Donald Duck&quot;,</span><br><span class="line">          city:&quot;Duckburg&quot;</span><br><span class="line">            </span><br><span class="line">  &#125;,</span><br><span class="line">  function(dat)&#123;</span><br><span class="line">      alert(&quot;Data: &quot; + data + &quot;\nStatus: &quot; + status);</span><br><span class="line">        </span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/04/15/jquery2/" itemprop="url">
                  jQuery Review 2
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-04-15T18:28:48+08:00" content="2015-04-15">
              2015-04-15
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/JavaScript/" itemprop="url" rel="index">
                    <span itemprop="name">JavaScript</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/04/15/jquery2/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/04/15/jquery2/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="隐藏相关"><a href="#隐藏相关" class="headerlink" title="隐藏相关"></a>隐藏相关</h2><h3 id="jQuery-隐藏-显示"><a href="#jQuery-隐藏-显示" class="headerlink" title="jQuery 隐藏/显示"></a>jQuery 隐藏/显示</h3><blockquote>
<p>隐藏元素使用<code>hide()</code>方法, 显示元素使用<code>show()</code>方法. 隐藏显示切换使用<code>toggle()</code>方法. 这3个方法都可以设置切换速度和回调方法:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(selector).hide(speed,callback);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>speed 可以为毫秒数或者’slow/fast’</p>
</blockquote>
<h2 id="jQuery-淡入淡出"><a href="#jQuery-淡入淡出" class="headerlink" title="jQuery 淡入淡出"></a>jQuery 淡入淡出</h2><blockquote>
<p>和<code>hide/show/toggle</code>很像, 可以使用<code>fadeIn/fadeOut/fadeToggle</code> 对元素进行淡入/淡出以及两者的切换, 同样地也可以设置speed和回调方法.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$(&quot;button&quot;).click(function()&#123;</span><br><span class="line">  $(&quot;#div1&quot;).fadeOut();</span><br><span class="line">  $(&quot;#div2&quot;).fadeOut(&quot;slow&quot;);</span><br><span class="line">  $(&quot;#div3&quot;).fadeOut(3000);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>还有一个fadeTo 方法, 它允许元素渐变为制定的透明度:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(selector).fadeTo(speed,opacity,callback);</span><br></pre></td></tr></table></figure>
<h3 id="jQuery-滑动效果"><a href="#jQuery-滑动效果" class="headerlink" title="jQuery 滑动效果"></a>jQuery 滑动效果</h3><blockquote>
<p>同理: 以滑动的方式显示隐藏或者切换元素, 方法分别是<code>slideDown, slideUp, slideToggle</code></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(selector).slideToggle(speed,callback);</span><br></pre></td></tr></table></figure>
<h2 id="jQuery-动画效果"><a href="#jQuery-动画效果" class="headerlink" title="jQuery 动画效果"></a>jQuery 动画效果</h2><blockquote>
<p>jQuery 使用<code>animate()</code>方法使用动画效果:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(selector).animate(&#123;params&#125;, speed, callback);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这里的<code>params</code>定义了形成动画的css属性</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$(&quot;button&quot;).click(function()&#123;</span><br><span class="line">  $(&quot;div&quot;).animate(&#123;left:&apos;250px&apos;&#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>默认地，所有 HTML 元素都有一个静态位置，且无法移动。<br>如需对位置进行操作，要记得首先把元素的 CSS position 属性设置为 relative、fixed 或 absolute！</p>
<p>当然也可以操作多个css属性:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$(&quot;button&quot;).click(function()&#123;</span><br><span class="line">  $(&quot;div&quot;).animate(&#123;</span><br><span class="line">    left:&apos;250px&apos;,</span><br><span class="line">    opacity:&apos;0.5&apos;,</span><br><span class="line">    height:&apos;150px&apos;,</span><br><span class="line">    width:&apos;150px&apos;</span><br><span class="line">          </span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意属性名需要写成Camel形式.<br>还可以使用相对值: <code>height:&#39;+=150px&#39;</code></p>
<p>甚至可以把属性的动画设为”show” “toggle”等:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$(&quot;button&quot;).click(function()&#123;</span><br><span class="line">  $(&quot;div&quot;).animate(&#123;</span><br><span class="line">      height:&apos;toggle&apos;</span><br><span class="line">        </span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>默认地，jQuery 提供针对动画的队列功能。也就是多个<code>animate</code>方法是依次执行的:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$(&quot;button&quot;).click(function()&#123;</span><br><span class="line">  var div=$(&quot;div&quot;);</span><br><span class="line">  div.animate(&#123;height:&apos;300px&apos;,opacity:&apos;0.4&apos;&#125;,&quot;slow&quot;);</span><br><span class="line">  div.animate(&#123;width:&apos;300px&apos;,opacity:&apos;0.8&apos;&#125;,&quot;slow&quot;);</span><br><span class="line">  div.animate(&#123;height:&apos;100px&apos;,opacity:&apos;0.4&apos;&#125;,&quot;slow&quot;);</span><br><span class="line">  div.animate(&#123;width:&apos;100px&apos;,opacity:&apos;0.8&apos;&#125;,&quot;slow&quot;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="jQuery-停止动画"><a href="#jQuery-停止动画" class="headerlink" title="jQuery 停止动画"></a>jQuery 停止动画</h3><blockquote>
<p>使用<code>stop()</code>方法可以停止动画:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(selector).stop(stopAll, goToEnd);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>可选的 stopAll 参数规定是否应该清除动画队列。默认是 false，即仅停止活动的动画，允许任何排入队列的动画向后执行。可选的 goToEnd 参数规定是否立即完成当前动画。默认是 false。</p>
</blockquote>
<h3 id="jQuery-Callback-函数"><a href="#jQuery-Callback-函数" class="headerlink" title="jQuery Callback 函数"></a>jQuery Callback 函数</h3><blockquote>
<p>Callback 函数在当前动画 100% 完成之后执行。语法:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(selector).hide(speed,callback);</span><br></pre></td></tr></table></figure>
<h3 id="jQuery-Chaining"><a href="#jQuery-Chaining" class="headerlink" title="jQuery - Chaining"></a>jQuery - Chaining</h3><blockquote>
<p>jQuery 也可以连续调用方法.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(&quot;#p1&quot;).css(&quot;color&quot;,&quot;red&quot;).slideUp(2000).slideDown(2000);</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/04/15/jquery/" itemprop="url">
                  jQuery Review 1
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-04-15T14:19:43+08:00" content="2015-04-15">
              2015-04-15
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/JavaScript/" itemprop="url" rel="index">
                    <span itemprop="name">JavaScript</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/04/15/jquery/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/04/15/jquery/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>对jQuery进行一下总结, 最近发现之前用得稀里糊涂, 没有一个良好的知识体系.</p>
</blockquote>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><blockquote>
<p>一种方法是去jquery的官方网站<a href="http://jquery.com/download/" target="_blank" rel="external">http://jquery.com/download/</a> 下载所要的版本, 然后在HTML中引入即可:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;head&gt;</span><br><span class="line">&lt;script src=&quot;jquery.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>另外一种方法是使用CDN(内容分发网络)应用jquery. Google或者微软的服务器上存有jquery了, 只需引用即可:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># Google CDN</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;script src=&quot;http://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js&quot;&gt;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line"># 微软CDN</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;script src=&quot;http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.8.0.js&quot;&gt;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这样做还有一个优势用户访问别的网站时, 已经从这2个公司的服务器上缓存了jquery, 访问自己的站点可以大大减少加载时间, 而且我觉得这样做更优雅一些.</p>
</blockquote>
<h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><blockquote>
<p>实际上jquery可以理解为 javascript query(查询), 也就是查询选取HTML文档的元素, 然后对选取的元素执行操作(action).</p>
</blockquote>
<h3 id="属性的选取"><a href="#属性的选取" class="headerlink" title="属性的选取"></a>属性的选取</h3><blockquote>
<p>选取HTML元素可以有下面4种方法:</p>
</blockquote>
<ol>
<li>选取当前的HTML元素</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(this)</span><br></pre></td></tr></table></figure>
<ol>
<li>通过元素id选取元素</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(&quot;#test&quot;)</span><br></pre></td></tr></table></figure>
<ol>
<li>通过元素本身选取</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(&quot;p&quot;)</span><br></pre></td></tr></table></figure>
<ol>
<li>通过元素class选取</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(&quot;.test&quot;)</span><br></pre></td></tr></table></figure>
<h3 id="action"><a href="#action" class="headerlink" title="action"></a>action</h3><blockquote>
<p>选取了元素之后就要在元素身上调用方法, 即: <code>$(selector).action()</code></p>
</blockquote>
<ul>
<li>美元符号表示正在使用jquery</li>
<li><code>(selector)</code>表示所要选择的HTML元素</li>
<li><code>action()</code>表示对元素执行的操作</li>
</ul>
<h3 id="document-ready"><a href="#document-ready" class="headerlink" title="$(document).ready()"></a>$(document).ready()</h3><blockquote>
<p>这是文档就绪函数, 我们的代码要写在<code>document ready</code>中:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$(document).ready(function()&#123;</span><br><span class="line">  // Hack here</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这样就确保文档完全加载后, 执行jquery代码.</p>
</blockquote>
<h2 id="jquery的选择器"><a href="#jquery的选择器" class="headerlink" title="jquery的选择器"></a>jquery的选择器</h2><blockquote>
<p>选择器的作用就是帮助我们准确地找出需要DOM元素</p>
</blockquote>
<h3 id="jQuery-元素选择器"><a href="#jQuery-元素选择器" class="headerlink" title="jQuery 元素选择器"></a>jQuery 元素选择器</h3><blockquote>
<p>jquery使用CSS选择器来选取HTML元素.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$(&apos;p&apos;) 选取&lt;p&gt;元素</span><br><span class="line">$(&apos;p.intro&apos;) 选取class=&apos;intro&apos;的&lt;p&gt;元素</span><br><span class="line">$(&apos;p#demo&apos;) 选取id=&apos;demo&apos;的&lt;p&gt;元素</span><br></pre></td></tr></table></figure>
<h3 id="jQuery-属性选择器"><a href="#jQuery-属性选择器" class="headerlink" title="jQuery 属性选择器"></a>jQuery 属性选择器</h3><blockquote>
<p>jquery使用XPath表达式来选择带有给定属性的元素.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$(&quot;[href]&quot;) 选取所有带有href属性的元素</span><br><span class="line"></span><br><span class="line">$(&quot;[href=&apos;#&apos;]&quot;) 选取所有href属性为#的元素.</span><br><span class="line"></span><br><span class="line">$(&quot;[href!=&apos;#&apos;]&quot;) 选取所有href属性不等于#的元素</span><br><span class="line"></span><br><span class="line">$(&quot;[href$=&apos;.jpg&apos;]&quot;) 选取所有href属性以&quot;.jpg&quot;结尾的元素.</span><br></pre></td></tr></table></figure>
<h3 id="jQuery-CSS选择器"><a href="#jQuery-CSS选择器" class="headerlink" title="jQuery CSS选择器"></a>jQuery CSS选择器</h3><blockquote>
<p>jQuery CSS选择器可以用于改变HTML的CSS属性</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(&apos;p&apos;).css(&apos;background-color&apos;, &apos;red&apos;) 把p元素的背景变为红色</span><br></pre></td></tr></table></figure>
<h3 id="其他选择器"><a href="#其他选择器" class="headerlink" title="其他选择器"></a>其他选择器</h3><blockquote>
<p>选择第一个元素:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(&apos;ul li:first&apos;) 所有ul下第一个li元素</span><br></pre></td></tr></table></figure>
<h2 id="jQuery-事件"><a href="#jQuery-事件" class="headerlink" title="jQuery 事件"></a>jQuery 事件</h2><blockquote>
<p>事件处理是HTML中发生某些事件所调用的方法, 比如一个按钮被点击指的就是一个事件, 而点击后隐藏所有的p标签就是对事件的处理:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;jquery.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">$(document).ready(function()&#123;</span><br><span class="line">$(&quot;button&quot;).click(function()&#123;</span><br><span class="line">    $(&quot;p&quot;).hide();</span><br><span class="line">      </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h2&gt;This is a heading&lt;/h2&gt;</span><br><span class="line">&lt;p&gt;This is a paragraph.&lt;/p&gt;</span><br><span class="line">&lt;p&gt;This is another paragraph.&lt;/p&gt;</span><br><span class="line">&lt;button&gt;Click me&lt;/button&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果几个HTML文件都需要某些相同的js函数, 那么可以将这些js函数放到单独的文件中管理, 然后在HTML中引用即可.</p>
<p>如果jquery库与别的库发生了命名冲突, 可以替换<code>$</code>为别的字符来表示jQuery :</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var jQ = jQuery.noConflict();</span><br><span class="line"></span><br><span class="line">jQ(&apos;button&apos;) ...</span><br></pre></td></tr></table></figure>
<blockquote>
<p>其他的事件可参考 <a href="http://www.w3school.com.cn/jquery/jquery_ref_events.asp" target="_blank" rel="external">http://www.w3school.com.cn/jquery/jquery_ref_events.asp</a></p>
</blockquote>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/04/07/rspec-mock/" itemprop="url">
                  Rspec 中对mock的理解和使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-04-07T15:24:50+08:00" content="2015-04-07">
              2015-04-07
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Test/" itemprop="url" rel="index">
                    <span itemprop="name">Test</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/04/07/rspec-mock/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/04/07/rspec-mock/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>其实回家也很无聊, 我就来总结一下RSpec 中的Mock.</p>
</blockquote>
<h2 id="Mock是什么-stub是什么-test-double是什么-…"><a href="#Mock是什么-stub是什么-test-double是什么-…" class="headerlink" title="Mock是什么? stub是什么? test double是什么? …"></a>Mock是什么? stub是什么? test double是什么? …</h2><blockquote>
<p>以我的理解, Mock是对一个真实的对象的冒充, 当我们无法使用真正的对象时, 就使用mock. 为此我去查了<a href="http://en.wikipedia.org/wiki/Test_double" target="_blank" rel="external">维基百科</a>, 它是这么解释的:</p>
</blockquote>
<ul>
<li>test stub : 用于提供有间接输入的测试代码</li>
<li>test spy : 用于检验测试对象的间接的输出, 后断言期待的值, 在测试执行之前, 不会去事先定义期待值</li>
<li>mock object 用于检验测试代码的间接输出, 在测试代码执行前事先定义期待值</li>
<li>Fake object 用作简化的实现, 比如使用内存数据库代替真正的数据库访问</li>
<li>Dummy object 用于一个参数被被测试的方法需要, 但是这个参数根据没有被用到</li>
</ul>
<blockquote>
<p>对不住大家了, 这段翻译的有写不恰当, 但是想不出更好的办法了, 读不懂建议去读原文, 再不行就忽略吧, 继续往下看, 如何选择合适的方法.</p>
</blockquote>
<h2 id="mock的使用方法"><a href="#mock的使用方法" class="headerlink" title="mock的使用方法"></a>mock的使用方法</h2><blockquote>
<p>比如说, 现在要去测试一下Twitter是不是成功发了一条推文:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">require &apos;twitter&apos;</span><br><span class="line">class TwitterEmotion</span><br><span class="line">  def tweet</span><br><span class="line">    twitter_client.update &quot;I am very happy&quot;</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  def twitter_client</span><br><span class="line">    Twitter::REST::Client.new</span><br><span class="line">  end</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<blockquote>
<p>测试代码:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">it &quot;should tweet successfully&quot; do</span><br><span class="line">  emotion = TwitterEmotion.new</span><br><span class="line">  expect&#123; emotion.tweet &#125;.not_to raise_error</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<blockquote>
<p>但是这真的会把你的推文发生出去, 还有, 如果网络环境不好或者Twitter的服务器没有及时处理请求, 那么我这边的测试就会跑不通, 等等问题.<br>正因为如此, 才需要把使用Twitter服务的部分用mock代替. 这样测试就不会和Twitter进行交互了.下面是使用mock后的测试:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">it &quot;should tweet successfully&quot; do</span><br><span class="line">  # mock Twitter client</span><br><span class="line">  twitter_client_mock = double(&apos;Twitter client&apos;)</span><br><span class="line">  # 让update方法可以在mock对象上调用</span><br><span class="line">  allow(twitter_client_mock).to receive(:update)</span><br><span class="line">  emotion = TwitterEmotion.new</span><br><span class="line">  allow(emotion).to receive(:twitter_client).and_return(twitter_client_mock)</span><br><span class="line"></span><br><span class="line">  # 如果在emotion上调用了twitter_client, 那么就返回twitter_client_mock</span><br><span class="line">  expect&#123; emotion.tweet &#125;.not_to raise_error</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<blockquote>
<p>接下来就分析这几个步骤:</p>
</blockquote>
<h3 id="创建空的mock对象"><a href="#创建空的mock对象" class="headerlink" title="创建空的mock对象"></a>创建空的mock对象</h3><blockquote>
<p>先创建了假的<code>Twitter::REST::Client</code> :</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">twitter_client_mock = double(&apos;Twitter client&apos;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用的方法是<code>double</code> , 参数可以是任意字符串, 但是该字符串在测试失败时候会被返回, 所以尽量使用相关的字符串, 下面就是失败时返回的信息:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RSpec::Mocks::MockExpectationError: Double &quot;Twitter client&quot; received unexpected message :update with (&quot;I am very happy&quot;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>另外, double这个词在英文中有替身的意思.</p>
</blockquote>
<h3 id="告诉mock对象如何回应"><a href="#告诉mock对象如何回应" class="headerlink" title="告诉mock对象如何回应"></a>告诉mock对象如何回应</h3><blockquote>
<p>可以将double方法生成的mock对象比喻成什么都不懂的婴儿, 需要我来教他, 再看看应用代码:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">def tweet</span><br><span class="line">  twitter_client.update &quot;I am very happy&quot;</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">def twitter_client</span><br><span class="line">  Twitter::REST::Client.new</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<blockquote>
<p>一旦调用<code>tweet</code>方法, 方法内部就会执行<code>twitter_client.update</code>. 所以, twitter_client的复制品twitter_client_mock也必须可以调用<code>update</code>方法(或者接收update消息) :</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">allow(twitter_client_mock).to receive(:update)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在RSpec中, 对于mock对象设定可以调用的方法的就可以采用这样的形式: <code>allow(mock_object).to receive(:method_name)</code></p>
<p>这时, <code>twitter_client_mock</code>对象上就可以调用<code>update</code>方法了, 但只能调用该方法.<br>一旦调用时错误发生了, 测试失败.</p>
</blockquote>
<h3 id="暗中把mock对象传入mock"><a href="#暗中把mock对象传入mock" class="headerlink" title="暗中把mock对象传入mock"></a>暗中把mock对象传入mock</h3><blockquote>
<p>现在还是会把Twitter真正的发送出去, 所以需要偷偷地把真正可以发生Twitter的对象<code>twitter_client</code> 换成这个假的<code>twitter_client_mock</code></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">emotion = TwitterEmotion.new</span><br><span class="line">allow(emotion).to receive(:twitter_client).and_return(twitter_client_mock)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>也就是:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">allow(想要替换方法的对象).to receive(所要替换的方法).and_return(返回值对象)</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="调用想测试的方法"><a href="#调用想测试的方法" class="headerlink" title="调用想测试的方法"></a>调用想测试的方法</h3><blockquote>
<p>现在已经做了如下的准备:</p>
</blockquote>
<ul>
<li>告诉mock对象(twitter_client_mock) 可以接收<code>update</code>方法</li>
<li>在所测试对象返回这个mock对象</li>
</ul>
<blockquote>
<p>然后正常测试代码即可:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect &#123; emotion.tweet &#125;.not_to raise_error</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这时候并不会真的发一条推文.</p>
</blockquote>
<h2 id="检查mock的方法是否正常执行"><a href="#检查mock的方法是否正常执行" class="headerlink" title="检查mock的方法是否正常执行"></a>检查mock的方法是否正常执行</h2><blockquote>
<p>把上面的测试代码做一个改动:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">it &quot;should tweet successfully&quot; do</span><br><span class="line">  # mock Twitter client</span><br><span class="line">  twitter_client_mock = double(&apos;Twitter client&apos;)</span><br><span class="line">  # 让update方法可以在mock对象上调用</span><br><span class="line">  expect(twitter_client_mock).to receive(:update)</span><br><span class="line">  emotion = TwitterEmotion.new</span><br><span class="line">  allow(emotion).to receive(:twitter_client).and_return(twitter_client_mock)</span><br><span class="line"></span><br><span class="line">  # 如果在emotion上调用了twitter_client, 那么就返回twitter_client_mock</span><br><span class="line">  expect&#123; emotion.tweet &#125;.not_to raise_error</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<blockquote>
<p>把原来的<code>allow(twitter_client_mock).to receive(:update)</code> 改成<code>expect(twitter_client_mock).to receive(:update)</code>, 也就是把<code>allow</code>换成了<code>expect</code>.<br><code>allow</code>只是让mock对象可以接收某个方法, <code>expect</code>则是验证该对象是否可以接收这个方法, 不能接收会返回错误.</p>
</blockquote>
<h2 id="mock使用方法补充知识"><a href="#mock使用方法补充知识" class="headerlink" title="mock使用方法补充知识"></a>mock使用方法补充知识</h2><h3 id="测试中错误的处理"><a href="#测试中错误的处理" class="headerlink" title="测试中错误的处理"></a>测试中错误的处理</h3><blockquote>
<p>如果刚才待测代码添加了异常处理: </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">require &apos;twitter&apos;</span><br><span class="line">class TwitterEmotion</span><br><span class="line">  def tweet</span><br><span class="line">    twitter_client.update &quot;I am very happy&quot;</span><br><span class="line">  rescue =&gt; e</span><br><span class="line">    notice(e)</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  def twitter_client</span><br><span class="line">    Twitter::REST::Client.new</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  def notice(e)</span><br><span class="line">    # 异常处理</span><br><span class="line">  end</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<blockquote>
<p>同样的在需要添加针对错误发生的情况下的测试:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">it &quot;shoud raise exception if error happens&quot; do</span><br><span class="line">   twitter_client_mock = double(&apos;Twitter client&apos;)</span><br><span class="line">   allow(twitter_client_mock).to receive(:update).and_raise(&apos;Error!&apos;)</span><br><span class="line">   emotion = TwitterEmotion.new</span><br><span class="line">   allow(emotion).to receive(:twitter_client).and_return(twitter_client_mock)</span><br><span class="line">   expect(emotion).to receive(:notice)</span><br><span class="line">   emotion.tweet</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<blockquote>
<p>首先需要注意这行代码:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">allow(twitter_client_mock).to receive(:update).and_raise(&apos;Error!&apos;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>可以总结为:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">allow(mock对象).to receive(方法).and_raise(异常)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>的形式. 人为让错误发生.</p>
<p>接下来需要注意这行代码:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(emotion).to receive(:notice)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>异常处理发生了的话那么emotion就会调用<code>notice</code>.<br>最后<code>emotion.tweet</code> 让程序在正常情况下执行.<br>同样, 如果把<code>allow</code>换成<code>expect</code>, 即<code>expect(twitter_client_mock).to receive(:update).and_raise(&#39;Error!&#39;)</code> 验证某个mock对象调用了某个方法后是否可以发生异常.</p>
</blockquote>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/04/06/deploy-with-capistrano-and-sunzi/" itemprop="url">
                  deploy_with_capistrano_and_sunzi
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-04-06T16:16:21+08:00" content="2015-04-06">
              2015-04-06
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/04/06/deploy-with-capistrano-and-sunzi/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/04/06/deploy-with-capistrano-and-sunzi/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails new todo -d postgresql</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/04/04/grape-with-rails/" itemprop="url">
                  Rails使用grape生成REST API(一)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-04-04T23:03:34+08:00" content="2015-04-04">
              2015-04-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Rails/" itemprop="url" rel="index">
                    <span itemprop="name">Rails</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/04/04/grape-with-rails/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/04/04/grape-with-rails/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="安装gem"><a href="#安装gem" class="headerlink" title="安装gem"></a>安装gem</h2><blockquote>
<p>新建一个Rails项目, 添加<code>grape</code>gem</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Gemfile</span><br><span class="line">gem &apos;grape&apos;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>bundle install</code></p>
</blockquote>
<h2 id="生成model"><a href="#生成model" class="headerlink" title="生成model"></a>生成model</h2><blockquote>
<p>生成zip(邮编)model</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rails g model zip zip_code:string  address:string</span><br><span class="line">  invoke  active_record</span><br><span class="line">  create  db/migrate/#&#123;yyyymmddssssss&#125;_create_zips.rb</span><br><span class="line">  create  app/models/zip.rb</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rake db:migrate</span><br></pre></td></tr></table></figure>
<blockquote>
<p>准备初始化数据:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># Read about fixtures at http://api.rubyonrails.org/classes/ActiveRecord/FixtureSet.html</span><br><span class="line"></span><br><span class="line">one:</span><br><span class="line">  zip_code: 10011</span><br><span class="line">  address: 北京市朝阳区</span><br><span class="line"></span><br><span class="line">two:</span><br><span class="line">  zip_code: 10050</span><br><span class="line">  address: 双鸭山林业局</span><br></pre></td></tr></table></figure>
<blockquote>
<p>导入数据库:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ rake fixture:load</span><br></pre></td></tr></table></figure>
<h2 id="实现API部分"><a href="#实现API部分" class="headerlink" title="实现API部分"></a>实现API部分</h2><blockquote>
<p>接下来就使用grape实现API部分, 新建文件<code>app/api/zip_api.rb</code>, 具体代码如下:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class Zip &lt; Grape::API</span><br><span class="line">  format :json</span><br><span class="line">  get &quot;zip/:zip_code&quot; do</span><br><span class="line">    zip = Zip.where(zip_code: params[:zip_code]).first</span><br><span class="line">    if zip</span><br><span class="line">      zip.to_json</span><br><span class="line">    end</span><br><span class="line">  end</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<blockquote>
<p>以上相当于不使用grape在Rails这样写:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># routes.rb</span><br><span class="line">get &quot;zip/:zip_code&quot; =&gt; &quot;zip#show&quot;, format: false</span><br><span class="line"></span><br><span class="line"># controller</span><br><span class="line"></span><br><span class="line">class ZipsController &lt; ApplicationController</span><br><span class="line">  def show</span><br><span class="line">    zip = Zip.where(zip_code: params[:zip_code]).first</span><br><span class="line">    if zip</span><br><span class="line">      json = zip.to_json</span><br><span class="line">    end</span><br><span class="line">    render text: json</span><br><span class="line">  end</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这里涉及到了2个方法:</p>
</blockquote>
<ul>
<li><code>format(format_to_response)</code> 指定API的响应格式, 可以指定xml, json, txt等格式</li>
<li><code>get(paths=[&#39;/&#39;], options={}, &amp;block)</code> : 表示处理客户端的GET请求(post, put, delete等)<ul>
<li><code>paths=[&#39;/&#39;]</code> 表示与请求对应的url, 数组可以指定多个url</li>
<li><code>[options]</code> 指定和paths匹配的条件</li>
<li><code>[block]</code> 具体逻辑代码</li>
</ul>
</li>
<li><code>params</code> 从中获取请求参数</li>
</ul>
<h2 id="部署到Rails中-让Rails加载这部分代码"><a href="#部署到Rails中-让Rails加载这部分代码" class="headerlink" title="部署到Rails中(让Rails加载这部分代码)"></a>部署到Rails中(让Rails加载这部分代码)</h2><blockquote>
<p>在Rails应用启动时加载这部分代码:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># config/application.rb</span><br><span class="line">config.paths.add File.join(&quot;app&quot;, &quot;api&quot;), glob: File.join(&quot;**&quot;, &quot;*.rb&quot;)</span><br><span class="line">config.autoload_paths += Dir[Rails.root.join(&quot;app&quot;, &quot;api&quot;, &quot;*&quot;)]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>添加到route中:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># config/routes.rb</span><br><span class="line">mount ZipAPI =&gt; &quot;/&quot;</span><br></pre></td></tr></table></figure>
<h2 id="浏览器访问"><a href="#浏览器访问" class="headerlink" title="浏览器访问"></a>浏览器访问</h2><blockquote>
<p>做完上面的工作之后, 启动rails项目, 访问<a href="http://localhost:3000/" target="_blank" rel="external">http://localhost:3000/</a> , 打开浏览器的console, 使用XMLHttpRequest访问API :</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var xhr = new XMLHttpRequest; </span><br><span class="line">xhr.open(&quot;get&quot;, &quot;http://localhost:3000/zip/10050&quot;); </span><br><span class="line">xhr.addEventListener(&quot;load&quot;, function()&#123;</span><br><span class="line">　console.log(this.responseText); </span><br><span class="line">&#125;);</span><br><span class="line">xhr.send();</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># =&gt; </span><br><span class="line">&quot;&#123;\&quot;id\&quot;:298486374,\&quot;zip_code\&quot;:\&quot;10050\&quot;,\&quot;address\&quot;:\&quot;双鸭山林业局\&quot;,\&quot;created_at\&quot;:\&quot;2015-04-04T11:53:57.000Z\&quot;,\&quot;updated_at\&quot;:\&quot;2015-04-04T11:53:57.000Z\&quot;&#125;&quot;</span><br></pre></td></tr></table></figure>
<p><img src="http://i2.tietuku.com/34f96188495b8106.png"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><blockquote>
<p>我参照<a href="https://github.com/intridea/grape" target="_blank" rel="external">grape文档</a>做了些简化修改, 实现了简单的API请求, 下一篇文章将更加详细介绍一下Grape的使用, 比如添加或者删除功能的实现方法, 并改进现在的代码.</p>
</blockquote>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/04/04/grape-with-rails2/" itemprop="url">
                  Rails使用grape生成REST API(二)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-04-04T23:03:34+08:00" content="2015-04-04">
              2015-04-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Rails/" itemprop="url" rel="index">
                    <span itemprop="name">Rails</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/04/04/grape-with-rails2/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/04/04/grape-with-rails2/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>接上一篇文章.</p>
</blockquote>
<h2 id="修改查找API"><a href="#修改查找API" class="headerlink" title="修改查找API :"></a>修改查找API :</h2><blockquote>
<p>上篇文章我为了说清楚问题, 所以使用最直接的代码来说明, 事实上, 我可以利用grape提供的一些方法把代码重构成这样:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">class ZipAPI &lt; Grape::API</span><br><span class="line">  format :json</span><br><span class="line">  helpers do</span><br><span class="line">    def search_address</span><br><span class="line">      Zip.where(zip_code: params[:zip_code]).first</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">    def not_found_error</span><br><span class="line">      error!(&quot;404 Not Found&quot;)</span><br><span class="line">    end</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  namespace &quot;zip/:zip_code&quot; do</span><br><span class="line">    get do</span><br><span class="line">      zip = search_address</span><br><span class="line">      if zip</span><br><span class="line">        zip.to_json</span><br><span class="line">      else</span><br><span class="line">        not_found_error</span><br><span class="line">      end</span><br><span class="line">    end</span><br><span class="line">  end</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<blockquote>
<p>所使用的方法: </p>
</blockquote>
<ul>
<li><code>helpers(new_mod=nil, &amp;block)</code> : 在该方法的block中定义一些helper方法, 然后在别处引用, 这样逻辑代码会更加简洁. <code>new_mod</code> 指引用其他module, 比如我想把这些帮助方法定义到一个单独的module文件中, 就可以在这里使用<code>helpers SomeHelper</code>来引用.</li>
<li><code>error!(message, status=nil, headers=nil)</code> : 由于返回错误的处理, <code>message</code> 是指返回的消息, <code>status</code> 返回错误状态码, 默认500, <code>headers=nil</code> : 使用hash来向响应header添加信息</li>
<li><code>namespace(space=nil, options={}, &amp;block)</code> : 对block中处理的内容设定其path的前缀.<ul>
<li><code>space</code> 指定前缀信息, 如”zip/:zip_code”</li>
<li><code>options</code> 对path的前缀进行约束限制</li>
<li><code>block</code> 具体处理的逻辑代码</li>
</ul>
</li>
</ul>
<h2 id="实现添加和删除的API"><a href="#实现添加和删除的API" class="headerlink" title="实现添加和删除的API"></a>实现添加和删除的API</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">class ZipAPI &lt; Grape::API</span><br><span class="line">  format :json</span><br><span class="line">  helpers do</span><br><span class="line">    def search_address</span><br><span class="line">      Zip.where(zip_code: params[:zip_code]).first</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">    def not_found_error</span><br><span class="line">      error!(&quot;404 Not Found&quot;)</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">    def add_zip</span><br><span class="line">      zip = search_address || Zip.new(zip_code: params[:zip_code])</span><br><span class="line">      zip.update(address: params[:address])</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">    def remove_zip</span><br><span class="line">      zip = search_address</span><br><span class="line">      zip.destroy if zip</span><br><span class="line">    end</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  namespace &quot;zip/:zip_code&quot; do</span><br><span class="line">    get do</span><br><span class="line">      zip = search_address</span><br><span class="line">      if zip</span><br><span class="line">        zip.to_json</span><br><span class="line">      else</span><br><span class="line">        not_found_error</span><br><span class="line">      end</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">    put do</span><br><span class="line">      add_zip</span><br><span class="line">      status 204</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">    delete do</span><br><span class="line">      if remove_zip</span><br><span class="line">        status 204</span><br><span class="line">      else</span><br><span class="line">        not_found_error</span><br><span class="line">      end</span><br><span class="line">    end</span><br><span class="line">  end</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<blockquote>
<p>我添加了<code>add_zip</code>来用于添加model, <code>remove_zip</code>用于删除model. 分别接受客户端的put请求和delete请求.<br>下面我在浏览器端使用javascript来调用这两个API :</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 添加</span><br><span class="line">var xhr_put = new XMLHttpRequest;</span><br><span class="line">xhr_put.open(&quot;put&quot;, &quot;http://localhost:3000/zip/10080&quot;);</span><br><span class="line">xhr_put.setRequestHeader(&quot;Content-type&quot;, &quot;application/x-www-form-urlencoded&quot;);</span><br><span class="line">xhr_put.send(&quot;address=中国移动&quot;)</span><br><span class="line"></span><br><span class="line"># 删除</span><br><span class="line">var xhr_del = new XMLHttpRequest;</span><br><span class="line">xhr_del.open(&quot;delete&quot;, &quot;http://localhost:3000/zip/10080&quot;);</span><br><span class="line">xhr_del.send();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用的方法:</p>
</blockquote>
<ul>
<li>status(status=nil) : 指定返回状态码</li>
</ul>
<h2 id="校验"><a href="#校验" class="headerlink" title="校验"></a>校验</h2><blockquote>
<p>我们可以从<code>params</code>方法中提取参数, 然后使用<code>require</code>方法添加约束条件:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[...]</span><br><span class="line">    params do</span><br><span class="line">      requires :zip_code, type: String, regexp: /^\d&#123;3&#125;-\d&#123;4&#125;$/</span><br><span class="line">      requires :address, type: String</span><br><span class="line">    end</span><br><span class="line">    put do</span><br><span class="line">      add_zip</span><br><span class="line">      status 204</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>方法及选项:</p>
</blockquote>
<ul>
<li>params(&amp;block) : 在block中进行具体的验证逻辑</li>
<li><code>requires(*attrs, &amp;block)</code><ul>
<li>attrs 指所要校验的属性名</li>
<li>block 校验请求参数中的嵌套属性:  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123; name:</span><br><span class="line">  &#123; given_name: &quot;Daniel&quot;,</span><br><span class="line">    family_name: &quot;Zhang&quot; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>选项: </p>
</blockquote>
<ul>
<li><code>type</code> : 指定类型</li>
<li><code>regexp</code> : 需要匹配的正则表达式</li>
<li><code>default</code> : 如果没有对应的值, 设定默认值.</li>
</ul>
<h2 id="基本认证"><a href="#基本认证" class="headerlink" title="基本认证"></a>基本认证</h2><blockquote>
<p>最后进行访问认证, 用户提供后方可进行操作:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[...]</span><br><span class="line">  http_basic do |username, password|</span><br><span class="line">    &#123;&quot;user&quot; =&gt; &quot;pass&quot;&#125;[username] == password</span><br><span class="line">  end</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这时候再去发送请求, 服务器就会要求验证:</p>
</blockquote>
<p><img src="http://i2.tietuku.com/34f96188495b8106.png"></p>
<blockquote>
<p>也可以直接在请求中传入验证用户名和密码:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xhr_put.open(&quot;put&quot;, &quot;http://localhost:3000/zip/171-0022&quot;, true, &quot;user&quot;, &quot;pass&quot;);</span><br></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><blockquote>
<p>到此, 已经介绍了grape最基本的用法, 详细内容请参考<a href="http://intridea.github.io/grape/docs/index.html#Basic_and_Digest_Auth" target="_blank" rel="external">http://intridea.github.io/grape/docs/index.html#Basic_and_Digest_Auth</a> . 不只是Rails中, Grape还可以用于Rack, Sinatra中, 有空一定要尝试一下, 不过后两者还不是很熟 ^^ .</p>
</blockquote>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.png"
               alt="Daniel Zhang" />
          <p class="site-author-name" itemprop="name">Daniel Zhang</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">105</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">104</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Daniel Zhang</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"danielhexo"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  





  
  
  

  

  

</body>
</html>
