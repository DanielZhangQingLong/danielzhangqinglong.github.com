<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  




<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/page/6/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
<meta name="twitter:description">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> Hexo </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Hexo</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="#" class="st-search-show-outputs">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <form class="site-search-form">
  <input type="text" id="st-search-input" class="st-search-input st-default-search-input" />
</form>

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', 'uSvyVbAJs-5jfXFawgQ3','2.0.0');
</script>



    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/03/02/rails-test-install/" itemprop="url">
                  在Rails中使用Cucumber和RSpec搭建BDD/TDD测试环境
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-03-02T09:57:46+08:00" content="2015-03-02">
              2015-03-02
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Rails/" itemprop="url" rel="index">
                    <span itemprop="name">Rails</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/03/02/rails-test-install/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/03/02/rails-test-install/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="什么是TDD"><a href="#什么是TDD" class="headerlink" title="什么是TDD ?"></a>什么是TDD ?</h2><blockquote>
<p>TDD就是测试驱动开发, 也就是说先写测试代码, 然后运行, 测试不会通过, 然后为了通过测试而实现代码. 最后需要重构重复代码, 而且需要保证重构代码后测试还可以通过.<br>从设计而言, 由于先写了测试, 从测试的角度去定义实现方法要比仅仅去实现功能而定义方法要好. TDD可以消除更多的重复代码, 使结构更加清晰, 但是也有人不同意这种开发手法, 认为浪费时间.<br>使用TDD需要注意:  一开始的测试必须要写, 测试需要覆盖到每一个要实现的功能, 但是需要灵活运用TDD, 比如在不确定一个问题的解决方法时, 先不要忙着写测试, 而是先试着去写实现代码, 得到正确的结果后再去写测试会更加清晰.</p>
</blockquote>
<h2 id="本文使用的环境"><a href="#本文使用的环境" class="headerlink" title="本文使用的环境"></a>本文使用的环境</h2><ul>
<li>Mac OSX 10.10</li>
<li>ruby 2.2.0p0</li>
<li>Rails 4.2.0</li>
<li>cucumber-rails 1.4.2</li>
<li>rspec-rails 3.2.1</li>
</ul>
<h2 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h2><h3 id="创建rails项目"><a href="#创建rails项目" class="headerlink" title="创建rails项目"></a>创建rails项目</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ rails new test_rspec_cucumber --skip-test-unit </span><br><span class="line"># --skip-test-unit 不使用Rails默认提供的test unit</span><br></pre></td></tr></table></figure>
<h3 id="添加gem"><a href="#添加gem" class="headerlink" title="添加gem"></a>添加gem</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># Gemfile</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">group :development, :test do</span><br><span class="line">  gem &apos;sqlite3&apos;</span><br><span class="line">  gem &apos;rspec-rails&apos;</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">group :test do</span><br><span class="line">  gem &apos;selenium-webdriver&apos;</span><br><span class="line">  gem &apos;capybara&apos;</span><br><span class="line">  gem &apos;factory_girl_rails&apos;</span><br><span class="line">  gem &apos;cucumber-rails&apos;, :require =&gt; false</span><br><span class="line">  gem &apos;database_cleaner&apos;, github: &apos;bmabey/database_cleaner&apos;</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">group :production do</span><br><span class="line">  gem &apos;pg&apos;</span><br><span class="line">  gem &apos;rails_12factor&apos;</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><blockquote>
<p>bundle install –without production</p>
</blockquote>
<h3 id="在项目中安装RSpec"><a href="#在项目中安装RSpec" class="headerlink" title="在项目中安装RSpec"></a>在项目中安装RSpec</h3><blockquote>
<p>生成RSpec相关的文件</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ rails g rspec:install</span><br><span class="line">  create  .rspec</span><br><span class="line">  create  spec</span><br><span class="line">  create  spec/spec_helper.rb</span><br><span class="line">  create  spec/rails_helper.rb</span><br></pre></td></tr></table></figure>
<h3 id="安装cucumber"><a href="#安装cucumber" class="headerlink" title="安装cucumber"></a>安装cucumber</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ rails generate cucumber:install</span><br><span class="line">  create  config/cucumber.yml</span><br><span class="line">  create  script/cucumber</span><br><span class="line">  chmod  script/cucumber</span><br><span class="line">  create  features/step_definitions</span><br><span class="line">  create  features/step_definitions/.gitkeep</span><br><span class="line">  create  features/support</span><br><span class="line">  create  features/support/env.rb</span><br><span class="line">  exist  lib/tasks</span><br><span class="line">  create  lib/tasks/cucumber.rake</span><br><span class="line">  gsub  config/database.yml</span><br><span class="line">  gsub  config/database.yml</span><br><span class="line">  force  config/database.yml</span><br></pre></td></tr></table></figure>
<blockquote>
<p>本文只介绍安装过程, 下篇文章会总结关于RSpec和Cucumber的具体使用方法.</p>
</blockquote>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/02/25/log-logger/" itemprop="url">
                  Rails log 总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-02-25T09:17:00+08:00" content="2015-02-25">
              2015-02-25
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Rails/" itemprop="url" rel="index">
                    <span itemprop="name">Rails</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/02/25/log-logger/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/02/25/log-logger/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>本文总结一下rails中的日志相关知识点, 如日志输出, 设置日志等级, 创建新日志, 设置日志格式的方法.</p>
</blockquote>
<h2 id="输出日志"><a href="#输出日志" class="headerlink" title="输出日志"></a>输出日志</h2><blockquote>
<p>通过使用<code>logger</code>对象从Controller, Model, View输出日志到输出目的地:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">logger.debug &quot;输出debug级别的日志&quot;</span><br><span class="line">logger.fatal &quot;输出致命错误信息&quot;</span><br><span class="line">logger.error &quot;输出错误信息&quot;</span><br><span class="line">logger.warn &quot;输出警告&quot;</span><br><span class="line">logger.info &quot;输出通知信息&quot;</span><br></pre></td></tr></table></figure>
<h2 id="设定日志级别"><a href="#设定日志级别" class="headerlink" title="设定日志级别"></a>设定日志级别</h2><h3 id="5种日志的意义"><a href="#5种日志的意义" class="headerlink" title="5种日志的意义"></a>5种日志的意义</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fatal # 程序错误, 无法进行错误处理的</span><br><span class="line">error # 可以处理的错误</span><br><span class="line">warn # 警告</span><br><span class="line">info # 系统运行信息</span><br><span class="line">debug # 方便开发者的详细信息</span><br></pre></td></tr></table></figure>
<h3 id="显示日志"><a href="#显示日志" class="headerlink" title="显示日志"></a>显示日志</h3><blockquote>
<p>以上几种日志的优先级 <code>fatal &gt; error &gt; warn &gt; info &gt; debug</code></p>
<p>rails中可以在<code>config/development.rb</code>, <code>config/test.rb</code>, <code>config/production.rb</code>中针对这三种不同的环境设定日志级别.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># fatal &gt; error &gt; warn &gt; info &gt; debug</span><br><span class="line"># 优先级低于warn的不会被显示</span><br><span class="line">config.log_level = :warn</span><br></pre></td></tr></table></figure>
<h3 id="改变显示显示日志的级别"><a href="#改变显示显示日志的级别" class="headerlink" title="改变显示显示日志的级别"></a>改变显示显示日志的级别</h3><blockquote>
<p>如果临时需要显示warn以下等级的日志info debug等, 可以这样:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class UsersController &lt; ApplicationController</span><br><span class="line">  def index</span><br><span class="line">    Rails.logger.level = Logger::DEBUG   # Rails.logger.level = 0 也行</span><br><span class="line">  end</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h3 id="各个环境默认显示日志的级别"><a href="#各个环境默认显示日志的级别" class="headerlink" title="各个环境默认显示日志的级别"></a>各个环境默认显示日志的级别</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">development # =&gt; debug</span><br><span class="line">test        # =&gt; debug</span><br><span class="line">production  # =&gt; info</span><br></pre></td></tr></table></figure>
<h2 id="生成新logger"><a href="#生成新logger" class="headerlink" title="生成新logger"></a>生成新logger</h2><blockquote>
<p>可以指定日志输出文件, 可以在<code>config/development.rb、config/test.rb、config/production.rb</code>进行如下配置:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 输出日志到log/development.log.yyyyMMdd 中, 每天的日志输出到当日的文件中</span><br><span class="line">config.logger = Logger.new(&apos;log/development.log&apos;, &apos;daily&apos;)</span><br><span class="line"></span><br><span class="line"># 配置第二个输出文件</span><br><span class="line">config.special_logger = Logger.new(&apos;log/development_specail.log&apos;, &apos;daily&apos;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>日志的输出:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">logger.debug &quot;log/development.log&quot;</span><br><span class="line"></span><br><span class="line">Rails.application.config.special_logger.debug &quot;log/development_special.log输出&quot;</span><br></pre></td></tr></table></figure>
<h2 id="设定日志格式"><a href="#设定日志格式" class="headerlink" title="设定日志格式"></a>设定日志格式</h2><blockquote>
<p>默认的日志格式</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># config/RAILS_ENV.rb</span><br><span class="line">config.logger.formatter = ::Logger::Formatter.new</span><br><span class="line"></span><br><span class="line"># 输出</span><br><span class="line">D, [2015-02-25T14:24:39.780844 #24934] DEBUG -- :</span><br></pre></td></tr></table></figure>
<blockquote>
<p>自定义日志格式:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">config.logger.formatter = proc do |severity, datetime, progname, msg|</span><br><span class="line">  &quot;[#&#123;severity&#125;]#&#123;datetime&#125;: #&#123;progname&#125; ---- #&#123;msg&#125;\n&quot;</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"># 日志内容</span><br><span class="line">[INFO]2015-02-25 14:33:59 +0800:  ---- Started GET &quot;/assets/application-0019&quot;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/02/23/action-mailer/" itemprop="url">
                  发送邮件
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-02-23T20:40:08+08:00" content="2015-02-23">
              2015-02-23
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Rails/" itemprop="url" rel="index">
                    <span itemprop="name">Rails</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/02/23/action-mailer/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/02/23/action-mailer/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>Rails应用ActionMailer来发送和接收邮件, 我会参照官方文档总结这部分知识</p>
</blockquote>
<h2 id="生成Rails项目"><a href="#生成Rails项目" class="headerlink" title="生成Rails项目"></a>生成Rails项目</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 创建项目</span><br><span class="line">$ rails new mail_basis</span><br><span class="line"></span><br><span class="line">$ cd mail_basis</span><br><span class="line"></span><br><span class="line"># 生成Post scaffold 具备CRUD功能</span><br><span class="line">$ rails g scaffold Post title:string content:text</span><br><span class="line"></span><br><span class="line"># 移植数据库</span><br><span class="line">$ rake db:migrate</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这样就可以对Post进行增删改查操作.</p>
</blockquote>
<h2 id="发信"><a href="#发信" class="headerlink" title="发信"></a>发信</h2><blockquote>
<p>那么就来实现每当创建一个新的Post的时候就会发送一个邮件</p>
</blockquote>
<h3 id="生成Mailer"><a href="#生成Mailer" class="headerlink" title="生成Mailer"></a>生成Mailer</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ rails g mailer PostMailer</span><br><span class="line">  create  app/mailers/post_mailer.rb</span><br><span class="line">  invoke  erb</span><br><span class="line">  create    app/views/post_mailer</span><br><span class="line">  invoke  test_unit</span><br><span class="line">  create    test/mailers/post_mailer_test.rb</span><br><span class="line">  create    test/mailers/previews/post_mailer_preview.rb</span><br></pre></td></tr></table></figure>
<blockquote>
<p>类似于Controller, Mailer生成了以下比较重要的文件:</p>
</blockquote>
<ul>
<li>处理邮件的<code>app/mailers/xxx_mailer.rb</code></li>
<li>处理邮件显示的 <code>app/views/post_mailer.html.xxx</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># app/mailers/post_mailer.rb</span><br><span class="line"></span><br><span class="line">class PostMailer &lt; ActionMailer::Base</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<blockquote>
<p>同Controller和Model一样, 全部的mailer必须继承<code>ActiveMailer::Base</code>.<br>而且, 其中的action(方法)也会对应app/views/xxx_mailer/目录下的视图文件</p>
</blockquote>
<h3 id="实现发送邮件的方法"><a href="#实现发送邮件的方法" class="headerlink" title="实现发送邮件的方法"></a>实现发送邮件的方法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">class PostMailer &lt; ApplicationMailer</span><br><span class="line">  default from: &quot;from@ex.com&quot;</span><br><span class="line"></span><br><span class="line">  def post_email(user, post)</span><br><span class="line">    @title = post.title</span><br><span class="line">    mail to: user.email, subject: &quot;发帖成功&quot;</span><br><span class="line">  end</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<ul>
<li><code>default</code>方法设置发送方的地址, 相当于设置config.action_mailer.default(from: “from@ex.com”)</li>
<li><code>mail</code>方法是实际发送邮件的方法, <code>to</code>选项设定了实际发送的地址</li>
</ul>
<h3 id="邮件模板视图"><a href="#邮件模板视图" class="headerlink" title="邮件模板视图"></a>邮件模板视图</h3><blockquote>
<p>我们可以使用HTML或纯文本(TEXT)两种格式来生成邮件模板</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># HTML模板</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;ja&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;发布了新的博客&lt;%= @title %&gt;. &lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;</span><br><span class="line">恭喜你, 发布成功!</span><br><span class="line">&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"># TEXT</span><br><span class="line">==============================</span><br><span class="line">&lt;%= @title %&gt;发布成功!</span><br><span class="line">=============================</span><br><span class="line"></span><br><span class="line">恭喜!</span><br></pre></td></tr></table></figure>
<h3 id="在Controller中实现创建post并发送"><a href="#在Controller中实现创建post并发送" class="headerlink" title="在Controller中实现创建post并发送"></a>在Controller中实现创建post并发送</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># app/controllers/post_controller.rb</span><br><span class="line">def create</span><br><span class="line">  @post = Post.new(post_params)</span><br><span class="line"></span><br><span class="line">  respond_to do |format|</span><br><span class="line">  if @post.save</span><br><span class="line"></span><br><span class="line">  user = User.new(&quot;name&quot;, &quot;shangrenzhidao@126.com&quot;)</span><br><span class="line">  PostMailer.post_email(user, @post).deliver_now</span><br><span class="line"></span><br><span class="line">  format.html &#123; redirect_to @post, notice: &apos;Post was successfully created.&apos;  &#125;</span><br><span class="line">  format.json &#123; render :show, status: :created, location: @post  &#125;</span><br><span class="line">  else</span><br><span class="line">  format.html &#123; render :new  &#125;</span><br><span class="line">  format.json &#123; render json: @post.errors, status: :unprocessable_entity  &#125;</span><br><span class="line">  end</span><br><span class="line">  end</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h2 id="设定SMTP邮件服务器"><a href="#设定SMTP邮件服务器" class="headerlink" title="设定SMTP邮件服务器"></a>设定SMTP邮件服务器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># config/environments/development.rb</span><br><span class="line"></span><br><span class="line">config.action_mailer.delivery_method = :smtp</span><br><span class="line">config.action_mailer.smtp_settings = &#123;</span><br><span class="line">  address:               &apos;smtp.gmail.com&apos;,</span><br><span class="line">  port:                  587,</span><br><span class="line">  domain:                &apos;example.com&apos;,</span><br><span class="line">  user_name:             &apos;&lt;Gmail用户名&gt;&apos;,</span><br><span class="line">  password:              &apos;&lt;Gmail密码&gt;&apos;,</span><br><span class="line">  authentication:        &apos;plain&apos;,</span><br><span class="line">  enable_starttls_auto:  true</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/02/23/json-xml-yaml/" itemprop="url">
                  读取和输出JSON, XML, YAML
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-02-23T17:06:17+08:00" content="2015-02-23">
              2015-02-23
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Rails/" itemprop="url" rel="index">
                    <span itemprop="name">Rails</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/02/23/json-xml-yaml/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/02/23/json-xml-yaml/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><code>ActiveSupport</code>为Array, Hash, Model和JSON, XML, YAML提供了互相转换的方法</p>
</blockquote>
<h2 id="读取JSON-ActiveSupport-JSON-decode"><a href="#读取JSON-ActiveSupport-JSON-decode" class="headerlink" title="读取JSON (ActiveSupport::JSON.decode)"></a>读取JSON (ActiveSupport::JSON.decode)</h2><blockquote>
<p>使用<code>ActiveSupport::JSON.decode</code>方法可以解析JSON形式的字符串, 将其转换为Hash.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ActiveSupport::JSON.decode(&quot;&#123;\&quot;id\&quot;: 1, \&quot;name\&quot;: \&quot;daniel\&quot;&#125;&quot;)</span><br><span class="line">=&gt; &#123;&quot;id&quot;=&gt;1, &quot;name&quot;=&gt;&quot;daniel&quot;&#125;</span><br><span class="line"></span><br><span class="line"># 转换是发生的异常处理</span><br><span class="line"></span><br><span class="line">begin</span><br><span class="line">  obj = ActiveSupport::JSON.decode(json_string)</span><br><span class="line">rescue ActiveSupport::JSON.parse_error</span><br><span class="line">  Rails.logger.warn(&quot;非法JSON字符串: #&#123;json_string&#125;&quot;)</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h2 id="以JSON格式输出-to-json"><a href="#以JSON格式输出-to-json" class="headerlink" title="以JSON格式输出 (to_json)"></a>以JSON格式输出 (to_json)</h2><blockquote>
<p>使用<code>Object#to_json</code>方法可以将Array, Hash, ActiveRecord等以json格式输出:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[1, 2, 3].to_json</span><br><span class="line"># =&gt; &quot;[1,2,3]&quot;</span><br><span class="line"></span><br><span class="line">&#123; &quot;hash&quot; =&gt; &#123; &quot;foo&quot; =&gt; 1, &quot;bar&quot; =&gt; 2  &#125;  &#125;.to_json</span><br><span class="line"># =&gt; &quot;&#123;\&quot;hash\&quot;:&#123;\&quot;foo\&quot;:1,\&quot;bar\&quot;:2&#125;&#125;&quot;</span><br><span class="line"></span><br><span class="line">User.first.to_json</span><br><span class="line"> =&gt; &quot;&#123;\&quot;id\&quot;:1,\&quot;name\&quot;:\&quot;daniel\&quot;,\&quot;created_at\&quot;:\&quot;2015-02-23T18:35:01.069+08:00\&quot;,\&quot;updated_at\&quot;:\&quot;2015-02-23T18:35:23.611+08:00\&quot;,\&quot;time_zone\&quot;:null&#125;&quot;</span><br></pre></td></tr></table></figure>
<h2 id="读取XML-from-xml"><a href="#读取XML-from-xml" class="headerlink" title="读取XML (from_xml)"></a>读取XML (from_xml)</h2><blockquote>
<p>使用Hash.from_xml可以将XML文件(字符串)转换为hash</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">xml = &lt;&lt;-XML</span><br><span class="line">  &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">    &lt;hash&gt;</span><br><span class="line">      &lt;foo type=&quot;integer&quot;&gt;1&lt;/foo&gt;</span><br><span class="line">      &lt;bar type=&quot;integer&quot;&gt;2&lt;/bar&gt;</span><br><span class="line">    &lt;/hash&gt;</span><br><span class="line">XML</span><br><span class="line"></span><br><span class="line">hash = Hash.from_xml(xml)</span><br><span class="line"></span><br><span class="line">#=&gt; &#123;&quot;hash&quot;=&gt;&#123;&quot;foo&quot;=&gt;1, &quot;bar&quot;=&gt;2&#125;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="输出XML-to-xml"><a href="#输出XML-to-xml" class="headerlink" title="输出XML (to_xml)"></a>输出XML (to_xml)</h2><blockquote>
<p>将Array, Hash, ActiveRecord转化为XML</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[1, 2, 3].to_xml</span><br><span class="line"># =&gt; &quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot;?&gt;\n&lt;fixnums type=\&quot;array\&quot;&gt;\n  &lt;fixnum type=\&quot;integer\&quot;&gt;1&lt;/fixnum&gt;\n  &lt;fixnum type=\&quot;integer\&quot;&gt;2&lt;/fixnum&gt;\n  &lt;fixnum type=\&quot;integer\&quot;&gt;3&lt;/fixnum&gt;\n&lt;/fixnums&gt;\n&quot;</span><br><span class="line"></span><br><span class="line">&#123; &quot;hash&quot; =&gt; &#123; &quot;foo&quot; =&gt; 1, &quot;bar&quot; =&gt; 2  &#125;  &#125;.to_xml</span><br><span class="line"># =&gt; &quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot;?&gt;\n&lt;hash&gt;\n  &lt;hash&gt;\n    &lt;foo type=\&quot;integer\&quot;&gt;1&lt;/foo&gt;\n    &lt;bar type=\&quot;integer\&quot;&gt;2&lt;/bar&gt;\n  &lt;/hash&gt;\n&lt;/hash&gt;\n&quot;</span><br><span class="line"></span><br><span class="line">User.last.to_xml</span><br><span class="line">=&gt; &quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot;?&gt;\n&lt;user&gt;\n  &lt;id type=\&quot;integer\&quot;&gt;1&lt;/id&gt;\n  &lt;name&gt;daniel&lt;/name&gt;\n  &lt;created-at type=\&quot;dateTime\&quot;&gt;2015-02-23T18:35:01+08:00&lt;/created-at&gt;\n  &lt;updated-at type=\&quot;dateTime\&quot;&gt;2015-02-23T18:35:23+08:00&lt;/updated-at&gt;\n  &lt;time-zone nil=\&quot;true\&quot;/&gt;\n&lt;/user&gt;\n&quot;</span><br></pre></td></tr></table></figure>
<h2 id="读取YAML-YAML-load"><a href="#读取YAML-YAML-load" class="headerlink" title="读取YAML (YAML.load)"></a>读取YAML (YAML.load)</h2><blockquote>
<p>YAML.load可以读取yml格式的文件(字符串)</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">yaml = &lt;&lt;TEXT</span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">:id: 1</span><br><span class="line">:username: &quot;Daniel&quot;</span><br><span class="line">:age: 30</span><br><span class="line">TEXT</span><br><span class="line"></span><br><span class="line">YAML.load(yaml)</span><br><span class="line">=&gt; &#123;:id=&gt;3, :username=&gt;&quot;Daniel&quot;, :age=&gt;30&#125;</span><br><span class="line"></span><br><span class="line"># 文件中读取</span><br><span class="line">YAML.laod(File.open(&quot;test.yml&quot;))</span><br></pre></td></tr></table></figure>
<h2 id="输出YAML-to-yaml"><a href="#输出YAML-to-yaml" class="headerlink" title="输出YAML (to_yaml)"></a>输出YAML (to_yaml)</h2><blockquote>
<p><code>Object#to_yaml</code>可以把Array, Hash, ActiveRecord转为YAML形式输出</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[&quot;abc&quot;, &quot;def&quot;, &quot;zxy&quot;].to_yaml</span><br><span class="line"># =&gt; &quot;---\n- abc\n- def\n- zxy\n&quot;</span><br><span class="line"></span><br><span class="line">&#123;:id=&gt;3, :username=&gt;&quot;Daniel&quot;, :age=&gt;30&#125;.to_yaml</span><br><span class="line"> =&gt; &quot;---\n:id: 3\n:username: Daniel\n:age: 30\n&quot;</span><br><span class="line"></span><br><span class="line">User.last.to_yaml</span><br><span class="line"># =&gt; &quot;--- !ruby/object:User\nattributes:\n  id: 2\n  name: \&quot;Daniel\&quot;\n  created_at: 2014-11-29 09:02:30.449449000 Z\n  updated_at: 2014-11-29 09:02:30.449449000 Z\n&quot;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/02/23/name-conversion/" itemprop="url">
                  Rails中类名, 表名, 文件名之间互相转换
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-02-23T09:46:59+08:00" content="2015-02-23">
              2015-02-23
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/02/23/name-conversion/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/02/23/name-conversion/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>Rails有一些命名约定, 比如某个Model Post, 对应的数据库表名为posts, Controller为PostsController, 文件名为<code>posts_controller.rb</code> … ActiveSupport通过扩展ruby原生的String类来使这些名字互相转换变得简单.</p>
</blockquote>
<h2 id="单数-gt-复数-pluralize"><a href="#单数-gt-复数-pluralize" class="headerlink" title="单数 -&gt; 复数 (pluralize)"></a>单数 -&gt; 复数 (pluralize)</h2><blockquote>
<p>String类的pluralize方法可以将单数形式变为复数形式:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 单数变为复数</span><br><span class="line">&quot;post&quot;.pluralize     #=&gt; &quot;posts&quot;</span><br><span class="line">&quot;the post&quot;.pluralize #=&gt; &quot;the posts&quot;</span><br><span class="line"></span><br><span class="line"># 已经是复数形式原样返回</span><br><span class="line">&quot;posts&quot;.pluralize #=&gt; &quot;posts&quot;</span><br><span class="line"></span><br><span class="line"># 不规则变化</span><br><span class="line">&quot;person&quot;.pluralize # =&gt; &quot;people&quot;</span><br><span class="line"></span><br><span class="line"># 汉语词无复数, 需指定locale参数</span><br><span class="line">&quot;人&quot;.pluralize # =&gt; &quot;人s&quot;</span><br><span class="line">人&quot;.pluralize(locale = :zh) # =&gt; &quot;人&quot;</span><br></pre></td></tr></table></figure>
<h2 id="复数-gt-单数-singularize"><a href="#复数-gt-单数-singularize" class="headerlink" title="复数 -&gt; 单数 (singularize)"></a>复数 -&gt; 单数 (singularize)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 复数变为单数</span><br><span class="line">&quot;posts&quot;.singularize # =&gt; &quot;post&quot;</span><br><span class="line">&quot;the posts&quot;.singularize # =&gt; &quot;the post&quot;</span><br><span class="line"></span><br><span class="line"># 本来就是单数原样输出</span><br><span class="line">&quot;post&quot;.singularize #=&gt; &quot;post&quot;</span><br><span class="line"></span><br><span class="line"># 不规则变化</span><br><span class="line">&quot;people&quot;.singularize #=&gt; &quot;person&quot;</span><br></pre></td></tr></table></figure>
<h2 id="类名-gt-文件名-underscore"><a href="#类名-gt-文件名-underscore" class="headerlink" title="类名 -&gt; 文件名 (underscore)"></a>类名 -&gt; 文件名 (underscore)</h2><blockquote>
<p>String#underscore方法可以把对于的类名转换成文件名:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&quot;UsersControlller&quot;.underscore         #=&gt; &quot;users_controlller&quot;</span><br><span class="line">&quot;#&#123;&quot;UsersControlller&quot;.underscore&#125;.rb&quot; #=&gt; &quot;users_controlller.rb&quot;</span><br><span class="line"></span><br><span class="line">&quot;User&quot;.underscore          #=&gt; &quot;user&quot;</span><br><span class="line">&quot;User&quot;.underscore &lt;&lt; &quot;.rb&quot; #=&gt; &quot;user.rb&quot;</span><br><span class="line"></span><br><span class="line"># :: 转化为 /</span><br><span class="line"></span><br><span class="line">&quot;ActiveModel::Errors&quot;.underscore #=&gt; &quot;active_model/errors&quot;</span><br></pre></td></tr></table></figure>
<h2 id="文件名变为类名-camelcase"><a href="#文件名变为类名-camelcase" class="headerlink" title="文件名变为类名 (camelcase)"></a>文件名变为类名 (camelcase)</h2><blockquote>
<p>String#camelcase 方法可以把文件名(下划线形式)转化为类名:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&quot;users_controller&quot;.camelcase    #=&gt; &quot;UsersController&quot;</span><br><span class="line">&quot;users_controller.rb&quot;.camelcase #=&gt; &quot;UsersController.rb&quot;</span><br><span class="line"></span><br><span class="line">&quot;user&quot;.camelcase #=&gt; &quot;User&quot;</span><br><span class="line"></span><br><span class="line"># / 转化为 ::</span><br><span class="line"></span><br><span class="line">&quot;active_model/errors&quot;.camelcase #=&gt; &quot;ActiveModel::Errors&quot;</span><br></pre></td></tr></table></figure>
<h2 id="Model名变为表名-tableize"><a href="#Model名变为表名-tableize" class="headerlink" title="Model名变为表名 (tableize)"></a>Model名变为表名 (tableize)</h2><blockquote>
<p>String#tableize 方法可以将Model(User) 变为对于的数据库表名(users):</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;User&quot;.tableize     #=&gt; &quot;users&quot;</span><br><span class="line">&quot;LineItem&quot;.tableize #=&gt; &quot;line_items&quot;</span><br></pre></td></tr></table></figure>
<h2 id="表名转化为Model名-classify"><a href="#表名转化为Model名-classify" class="headerlink" title="表名转化为Model名 (classify)"></a>表名转化为Model名 (classify)</h2><blockquote>
<p>String#classify 方法可以把数据库表名(users)转化为对应的类名:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;users&quot;.classify      #=&gt; &quot;User&quot;</span><br><span class="line">&quot;line_items&quot;.classify #=&gt; &quot;LineItem&quot;</span><br></pre></td></tr></table></figure>
<h2 id="由类名-字符串-获取类对象-constantize"><a href="#由类名-字符串-获取类对象-constantize" class="headerlink" title="由类名(字符串)获取类对象 (constantize)"></a>由类名(字符串)获取类对象 (constantize)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&quot;User&quot;.constantize            #=&gt; User</span><br><span class="line">&quot;UsersController&quot;.constantize #=&gt; UsersController</span><br><span class="line"></span><br><span class="line">&quot;User&quot;.constantize.new</span><br><span class="line">#=&gt; #&lt;User id: nil, name: nil, created_at: nil, updated_at: nil&gt;</span><br><span class="line"></span><br><span class="line"># 如果类不存在则抛异常</span><br><span class="line"></span><br><span class="line">&quot;Hoge&quot;.constantize #=&gt; NameError: uninitialized constant Hoge</span><br></pre></td></tr></table></figure>
<h2 id="修改默认设置"><a href="#修改默认设置" class="headerlink" title="修改默认设置"></a>修改默认设置</h2><blockquote>
<p>如果想要更改默认变形, 可以修改<code>config/initializers/inflections.rb</code></p>
</blockquote>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/02/22/timecop/" itemprop="url">
                  Rails使用Timecop处理时间日期
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-02-22T22:17:09+08:00" content="2015-02-22">
              2015-02-22
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Rails/" itemprop="url" rel="index">
                    <span itemprop="name">Rails</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/02/22/timecop/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/02/22/timecop/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>有一个叫做<a href="https://github.com/travisjeffery/timecop" target="_blank" rel="external">timecop</a>的gem可以将时间移动到你想要的时刻, 暂停时刻等, 这个功能在与时间相关的测试中是很有用的, 比如说闰年测试, 税率变更, 有效期测试等等.</p>
</blockquote>
<h2 id="安装Timecop"><a href="#安装Timecop" class="headerlink" title="安装Timecop"></a>安装Timecop</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Gemfile</span><br><span class="line">group :test do</span><br><span class="line">  gem &apos;timecop&apos;</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h2 id="移动时间"><a href="#移动时间" class="headerlink" title="移动时间"></a>移动时间</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Time.now</span><br><span class="line">=&gt; 2015-02-22 22:38:25 +0800</span><br><span class="line">Timecop.travel(10.days.ago)</span><br><span class="line">=&gt; 2015-02-12 22:39:01 +0800</span><br><span class="line">Time.now</span><br><span class="line">=&gt; 2015-02-12 22:39:15 +0800</span><br><span class="line">Timecop.return</span><br><span class="line">=&gt; nil</span><br><span class="line">Time.now</span><br><span class="line">=&gt; 2015-02-22 22:39:40 +0800</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>Timecop.travel</code>可以指定一个block作为参数, 那么移动的时间只在block中有效</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">puts Time.now # =&gt; 2015-02-22 22:51:43 +0800</span><br><span class="line">Timecop.travel(10.days.ago) do</span><br><span class="line">  puts Time.now # =&gt; 2015-02-12 22:51:43 +0800</span><br><span class="line">end</span><br><span class="line">puts Time.now # =&gt; 2015-02-22 22:51:45 +0800</span><br></pre></td></tr></table></figure>
<h2 id="冻结时间"><a href="#冻结时间" class="headerlink" title="冻结时间"></a>冻结时间</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 时间静止在此刻</span><br><span class="line">Timecop.freeze(10.days.ago)</span><br><span class="line"> =&gt; 2015-02-12 22:58:58 +0800</span><br><span class="line"></span><br><span class="line">puts Time.zone.now</span><br><span class="line"> 2015-02-12 22:58:58 +0800</span><br><span class="line"></span><br><span class="line"># 经过10秒</span><br><span class="line">sleep 10</span><br><span class="line"></span><br><span class="line"># 时间无变化</span><br><span class="line">puts Time.zone.now</span><br><span class="line"> =&gt; 2015-02-12 22:58:58 +0800</span><br><span class="line"></span><br><span class="line"> # 解冻时间</span><br><span class="line">Timecop.return</span><br></pre></td></tr></table></figure>
<blockquote>
<p>同样, freeze方法也可以追加一个block作为参数, 时间停止的作用范围只在block中有效:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Timecop.freeze(10.days.ago) do</span><br><span class="line">  puts Time.now</span><br><span class="line">  sleep 10</span><br><span class="line">  puts Time.now</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"># =&gt;</span><br><span class="line">  2015-02-12 23:07:58 +0800</span><br><span class="line">  2015-02-12 23:07:58 +0800</span><br><span class="line"></span><br><span class="line">Timecop.return</span><br></pre></td></tr></table></figure>
<h2 id="时间加速"><a href="#时间加速" class="headerlink" title="时间加速"></a>时间加速</h2><blockquote>
<p>所谓加速就是现实经过1秒当做x秒: Timecop.scale(x)</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Timecop.scale(60) do</span><br><span class="line">  puts Time.now</span><br><span class="line">  sleep(10) # 1秒当做60秒, 那么就过了10分钟</span><br><span class="line">  puts Time.now</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"># =&gt; </span><br><span class="line">  2015-02-22 23:15:27 +0800</span><br><span class="line">  2015-02-22 23:25:27 +0800</span><br></pre></td></tr></table></figure>
<blockquote>
<p>以上的三种方法, 如果不使用block, 需要将时间调整回来 <code>Timecop.return</code></p>
</blockquote>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><blockquote>
<p><a href="https://github.com/travisjeffery/timecop" target="_blank" rel="external">https://github.com/travisjeffery/timecop</a></p>
</blockquote>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/02/22/time-related/" itemprop="url">
                  Rails中时间日期等处理的总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-02-22T08:39:28+08:00" content="2015-02-22">
              2015-02-22
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Rails/" itemprop="url" rel="index">
                    <span itemprop="name">Rails</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/02/22/time-related/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/02/22/time-related/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>Rails为了处理日期定义了<code>Date</code>类, 处理时刻定义了<code>Time</code>类. 为了更加容易处理时间日期等rails在ActiveSupport组件中扩展了timezone等功能, 接下来我就对Rails时间相关的处理进行总结.</p>
</blockquote>
<h2 id="设定时区"><a href="#设定时区" class="headerlink" title="设定时区"></a>设定时区</h2><blockquote>
<p>Rails中在<code>application.rb</code>设置时区:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># config/application.rb</span><br><span class="line"># 默认是UTC (0:00)</span><br><span class="line"></span><br><span class="line"># 北美时间</span><br><span class="line"># config.time_zone = &apos;Central Time (US &amp; Canada)&apos;</span><br><span class="line"></span><br><span class="line"># 北京时间</span><br><span class="line"># config.time_zone = &apos;Beijing&apos;</span><br></pre></td></tr></table></figure>
<h2 id="时区一览"><a href="#时区一览" class="headerlink" title="时区一览"></a>时区一览</h2><h3 id="显示所有时区"><a href="#显示所有时区" class="headerlink" title="显示所有时区"></a>显示所有时区</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">rake time:zones:all</span><br><span class="line">* UTC -11:00 *</span><br><span class="line">* American Samoa</span><br><span class="line">* International Date Line West</span><br><span class="line">* Midway Island</span><br><span class="line">* Samoa</span><br><span class="line">*</span><br><span class="line">* * UTC -10:00 *</span><br><span class="line">* Hawaii</span><br><span class="line">*</span><br><span class="line">* * UTC -09:00 *</span><br><span class="line">* Alaska</span><br><span class="line">* ...</span><br></pre></td></tr></table></figure>
<h3 id="操作系统所在时区"><a href="#操作系统所在时区" class="headerlink" title="操作系统所在时区"></a>操作系统所在时区</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">rake time:zones:local</span><br><span class="line">* UTC +08:00 *</span><br><span class="line">* Beijing</span><br><span class="line">* Chongqing</span><br><span class="line">* Hong Kong</span><br><span class="line">* Irkutsk</span><br><span class="line">* Kuala Lumpur</span><br><span class="line">* Perth</span><br><span class="line">* Singapore</span><br><span class="line">* Taipei</span><br><span class="line">* Ulaanbaatar</span><br></pre></td></tr></table></figure>
<h2 id="获取当前日期"><a href="#获取当前日期" class="headerlink" title="获取当前日期"></a>获取当前日期</h2><blockquote>
<p><code>Date.today</code> : 获取当前日期<br><code>Date.current</code> : 获取时区相关的当前日期, 相当于<code>Time.zone.today</code></p>
</blockquote>
<h2 id="获取当前时间"><a href="#获取当前时间" class="headerlink" title="获取当前时间"></a>获取当前时间</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 获取现在时间(操作系统时间, 时区不相关)</span><br><span class="line">Time.now</span><br><span class="line"></span><br><span class="line"># 获取时区相关时间</span><br><span class="line">Time.zone.now</span><br><span class="line"></span><br><span class="line">Time.current # 如果设置了 config.time_zone 返回Time.zone.now, 否则返回Time.now</span><br><span class="line"></span><br><span class="line">Time.current</span><br><span class="line"> =&gt; Sun, 22 Feb 2015 15:02:24 CST +08:00</span><br><span class="line"></span><br><span class="line">Time.zone.now</span><br><span class="line"> =&gt; Sun, 22 Feb 2015 15:02:28 CST +08:00</span><br><span class="line"></span><br><span class="line"># 不设置config.time_zone, 返回的是UTC(协调世界时间)</span><br><span class="line">Time.current</span><br><span class="line"> =&gt; Sun, 22 Feb 2015 07:12:54 UTC +00:00</span><br><span class="line"></span><br><span class="line">Time.zone.now</span><br><span class="line"> =&gt; Sun, 22 Feb 2015 07:12:59 UTC +00:00</span><br></pre></td></tr></table></figure>
<h2 id="生成指定的时间"><a href="#生成指定的时间" class="headerlink" title="生成指定的时间"></a>生成指定的时间</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Time.local # 获取指定的时间</span><br><span class="line"> Time.local(2014, 11, 29, 11, 22, 33)</span><br><span class="line">  =&gt; 2014-11-29 11:22:33 +0800</span><br><span class="line"></span><br><span class="line">Time.zone.local # 获取指定时区相关时间</span><br><span class="line">Time.zone.local(2014, 11, 29, 11, 22, 33)</span><br><span class="line"> =&gt; Sat, 29 Nov 2014 11:22:33 UTC +00:00</span><br></pre></td></tr></table></figure>
<h2 id="昨天-明天"><a href="#昨天-明天" class="headerlink" title="昨天, 明天"></a>昨天, 明天</h2><blockquote>
<p><code>Time#yesterday</code> : 昨天. <code>Time.tomorrow</code> : 明天.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">t = Time.local(2014, 11, 30)</span><br><span class="line">=&gt; 2014-11-30 00:00:00 +0800</span><br><span class="line"></span><br><span class="line">t.tomorrow</span><br><span class="line">=&gt; 2014-12-01 00:00:00 +0800</span><br><span class="line"></span><br><span class="line">t.yesterday</span><br><span class="line">=&gt; 2014-12-01 00:00:00 +0800</span><br><span class="line"></span><br><span class="line"># 时区相关</span><br><span class="line">t2 = Time.zone.local(2014, 11, 29)</span><br><span class="line"> =&gt; Sat, 29 Nov 2014 00:00:00 CST +08:00</span><br><span class="line"></span><br><span class="line">t2.yesterday</span><br><span class="line"> =&gt; Fri, 28 Nov 2014 00:00:00 CST +08:00</span><br><span class="line"></span><br><span class="line">t2.tomorrow</span><br><span class="line"> =&gt; Sun, 30 Nov 2014 00:00:00 CST +08:00</span><br></pre></td></tr></table></figure>
<h2 id="前-后-1年-月-prev-xxx-next-xxx"><a href="#前-后-1年-月-prev-xxx-next-xxx" class="headerlink" title="前(后)1年(月) (prev_xxx, next_xxx)"></a>前(后)1年(月) (prev_xxx, next_xxx)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Time#prev_month, Date#prev_month</span><br><span class="line">Time#next_month, Date#next_month</span><br><span class="line">Time#prev_year, Date#prev_year</span><br><span class="line">Time#next_year, Date#next_year</span><br></pre></td></tr></table></figure>
<h2 id="相对时间"><a href="#相对时间" class="headerlink" title="相对时间"></a>相对时间</h2><blockquote>
<p>Numeric类与下列方法组合可表示相对时间:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">years(年)</span><br><span class="line">months (月)</span><br><span class="line">weeks (周)</span><br><span class="line">days (日)</span><br><span class="line">hours (小时)</span><br><span class="line">minutes (分)</span><br><span class="line">seconds (秒)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>继续调用下面表示时间前后的方法:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">后: from_now 或者 since</span><br><span class="line">前: until 或者 ago</span><br><span class="line"></span><br><span class="line">Time.current</span><br><span class="line"> =&gt; Sun, 22 Feb 2015 15:51:46 CST +08:00</span><br><span class="line"></span><br><span class="line"> # 默认时间就是当前时间</span><br><span class="line">1.weeks.ago</span><br><span class="line"> =&gt; Sun, 15 Feb 2015 15:52:08 CST +08:00</span><br><span class="line"></span><br><span class="line">1.days.since</span><br><span class="line"> =&gt; Mon, 23 Feb 2015 15:52:41 CST +08:00</span><br><span class="line"></span><br><span class="line"># 不使用当前时间作为默认时间</span><br><span class="line">t = Time.local(2014, 11, 1)</span><br><span class="line"> =&gt; 2014-11-01 00:00:00 +0800</span><br><span class="line"></span><br><span class="line">1.days.since t</span><br><span class="line"> =&gt; 2014-11-02 00:00:00 +0800</span><br></pre></td></tr></table></figure>
<h2 id="获取开始和结束的时间点"><a href="#获取开始和结束的时间点" class="headerlink" title="获取开始和结束的时间点"></a>获取开始和结束的时间点</h2><blockquote>
<p>我们可以获得某个时间以何为单位的开始和结束:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">now = Time.current</span><br><span class="line"> =&gt; Sun, 22 Feb 2015 15:58:21 CST +08:00</span><br><span class="line"></span><br><span class="line">now.beginning_of_hour</span><br><span class="line">=&gt; Sun, 22 Feb 2015 15:00:00 CST +08:00  # 从15:00:00开始</span><br><span class="line"></span><br><span class="line">now.beginning_of_month</span><br><span class="line">=&gt; Sun, 01 Feb 2015 00:00:00 CST +08:00 # 从01 Feb开始</span><br><span class="line"></span><br><span class="line"># 其他类似方法有</span><br><span class="line">beginning_of_hour, end_of_hour</span><br><span class="line">beginning_of_day, end_of_day</span><br><span class="line">beginning_of_week, end_of_week</span><br><span class="line">beginning_of_month, end_of_month</span><br><span class="line">beginning_of_quarter, end_of_quarter # 季度(3个月)</span><br><span class="line">beginning_of_year, end_of_year</span><br></pre></td></tr></table></figure>
<blockquote>
<p>获取一个月的订单记录:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">now = Time.current #=&gt; Sat, 29 Nov 2014 02:26:53 CST -06:00</span><br><span class="line">Order.where(order_at: now.beginning_of_month..now.end_of_month)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/02/21/multi-form-submit/" itemprop="url">
                  一个表单中配置多个Submit
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-02-21T10:16:04+08:00" content="2015-02-21">
              2015-02-21
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Rails/" itemprop="url" rel="index">
                    <span itemprop="name">Rails</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/02/21/multi-form-submit/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/02/21/multi-form-submit/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>不要被标题所困惑, 举个例子, 比如你写完一篇博客, 在发布前, 我需要预览一下文章, 那么这个表单就有2个提交, 一个是发布, 一个是预览.</p>
</blockquote>
<p><img src="http://i2.tietuku.com/a7ac8d496d7f8dfb.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= form_for(@article) do |f| %&gt;</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  &lt;%= submit_tag &quot;Post&quot; %&gt;</span><br><span class="line">  &lt;%= submit_tag &quot;Preview&quot;, name: &quot;preview_button&quot; %&gt;</span><br><span class="line">&lt;% end %&gt;</span><br></pre></td></tr></table></figure>
<h2 id="点击Submit时的params"><a href="#点击Submit时的params" class="headerlink" title="点击Submit时的params"></a>点击Submit时的params</h2><blockquote>
<p>我们在分别点击”Post”和”Preview”按钮以后params参数情况:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># Post</span><br><span class="line"></span><br><span class="line">Parameters:</span><br><span class="line">&#123;</span><br><span class="line">  &quot;utf8&quot;=&gt;&quot;✓&quot;, &quot;authenticity_token&quot;=&gt;&quot;5Du...&quot;,</span><br><span class="line">  &quot;article&quot; =&gt; &#123;</span><br><span class="line">      &quot;title&quot;   =&gt; &quot;&quot;,</span><br><span class="line">          &quot;content&quot; =&gt; &quot;&quot;</span><br><span class="line">            </span><br><span class="line">  &#125;,</span><br><span class="line">    &quot;commit&quot; =&gt; &quot;Post&quot;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Parameters:</span><br><span class="line">&#123;</span><br><span class="line">  &quot;utf8&quot;=&gt;&quot;✓&quot;, &quot;authenticity_token&quot;=&gt;&quot;5Du...&quot;,</span><br><span class="line">  &quot;article&quot; =&gt; &#123;</span><br><span class="line">      &quot;title&quot;   =&gt; &quot;&quot;,</span><br><span class="line">          &quot;content&quot; =&gt; &quot;&quot;</span><br><span class="line">            </span><br><span class="line">  &#125;,</span><br><span class="line">    &quot;commit&quot; =&gt; &quot;Preview&quot;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>目前来看, 这两个按钮没有什么区别, 我们需要在Controller中对其提交的内容做不同的处理.</p>
</blockquote>
<h2 id="设定Submit按钮的name属性"><a href="#设定Submit按钮的name属性" class="headerlink" title="设定Submit按钮的name属性"></a>设定Submit按钮的name属性</h2><blockquote>
<p>我可以通过修改submit的name属性来改变params中的commit KEY:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= submit_tag &quot;Preview&quot;, name: &quot;preview_button&quot; %&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>点击按钮之后, params中是这样的:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Parameters:</span><br><span class="line">&#123;</span><br><span class="line">  &quot;utf8&quot;=&gt;&quot;✓&quot;, &quot;authenticity_token&quot;=&gt;&quot;5Du...&quot;,</span><br><span class="line">  &quot;article&quot; =&gt; &#123;</span><br><span class="line">      &quot;title&quot;   =&gt; &quot;&quot;,</span><br><span class="line">          &quot;content&quot; =&gt; &quot;&quot;</span><br><span class="line">            </span><br><span class="line">  &#125;,</span><br><span class="line">    # commit 变成了 preview_button</span><br><span class="line">    &quot;preview_button&quot; =&gt; &quot;Preview&quot;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Controller中分开处理"><a href="#Controller中分开处理" class="headerlink" title="Controller中分开处理"></a>Controller中分开处理</h2><blockquote>
<p>由于刚刚添加<code>preview_button</code> key, 我需要在Controller中加入针对<code>preview_button</code>这个key的判断, 再做出相应的处理:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># app/controllers/articles_controller.rb</span><br><span class="line"></span><br><span class="line">def create</span><br><span class="line">  @article = Article.new(article_params)</span><br><span class="line"></span><br><span class="line">  # params[:preview_button] 这个key存在, 或者, article无法保存(无法通过验证等等)</span><br><span class="line">  # 再一次渲染new视图(错误回显)</span><br><span class="line">  if params[:preview_button] || !@article.save</span><br><span class="line">    render :new</span><br><span class="line">  else</span><br><span class="line">    redirect_to @article, notice: &quot;Article was successfully created.&quot;</span><br><span class="line">  end</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h2 id="视图表示"><a href="#视图表示" class="headerlink" title="视图表示"></a>视图表示</h2><blockquote>
<p>填写完表单, 点击preview时, 需要在<code>_form.html.erb</code>中显示刚才填写的内容</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># app/views/articles/_form.html.erb</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">&lt;% if params[:preview_button] %&gt;</span><br><span class="line">  &lt;div class=&quot;preview&quot;&gt;</span><br><span class="line">    &lt;!-- 再显示一遍 --&gt;</span><br><span class="line">    &lt;div class=&quot;title&quot;&gt;</span><br><span class="line">      &lt;%= @article.title %&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class=&quot;content&quot;&gt;</span><br><span class="line">      &lt;%= simple_format @article.content %&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;% end %&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h2 id="效果展示"><a href="#效果展示" class="headerlink" title="效果展示"></a>效果展示</h2><blockquote>
<p>点击<code>Preview</code>后:</p>
</blockquote>
<p><img src="http://i2.tietuku.com/808589a08f69107a.png" alt=""></p>
<blockquote>
<p>点击<code>Post</code>提交到服务器</p>
</blockquote>
<p><img src="http://i2.tietuku.com/7fdfdf0114d37872.png" alt=""></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><blockquote>
<p><a href="http://railscasts.com/episodes/38-multibutton-form" target="_blank" rel="external">http://railscasts.com/episodes/38-multibutton-form</a></p>
</blockquote>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/02/20/format-helper/" itemprop="url">
                  Format Helper
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-02-20T20:48:16+08:00" content="2015-02-20">
              2015-02-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Rails/" itemprop="url" rel="index">
                    <span itemprop="name">Rails</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/02/20/format-helper/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/02/20/format-helper/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>Rails 为View提供了日期, 数值和文本的帮助方法, 下面就来看看这些帮助方法的使用.</p>
</blockquote>
<h2 id="文本相关"><a href="#文本相关" class="headerlink" title="文本相关"></a>文本相关</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># 显示debug信息</span><br><span class="line">&lt;%= debug(params) %&gt;</span><br><span class="line">&lt;%= debug(cookies) %&gt;</span><br><span class="line"></span><br><span class="line"># 转义成HTML</span><br><span class="line">my_text = &quot;Here is some basic text...\n...with a line break.&quot;</span><br><span class="line">simple_format(my_text)</span><br><span class="line"># =&gt; &quot;&lt;p&gt;Here is some basic text...\n&lt;br /&gt;...with a line break.&lt;/p&gt;&quot;</span><br><span class="line"></span><br><span class="line"># 高亮</span><br><span class="line">&lt;%= highlight( &quot;This is Daniel&quot;, &quot;Daniel&quot;  ) %&gt;</span><br><span class="line"></span><br><span class="line"># 指定高亮的格式</span><br><span class="line">&lt;%= highlight(&quot;This is Daniel, I am a brilliant boy! This is true&quot;, [&apos;Daniel&apos;, &apos;am&apos;], highlighter: &apos;    &lt;a href=&quot;search?q=\1&quot;&gt;\1&lt;/a&gt;&apos;) %&gt;</span><br><span class="line"></span><br><span class="line"># 省略</span><br><span class="line">&lt;%= truncate(&quot;This is something I hated that people who drank the fucking wine&quot;, lenth: 8) %&gt;</span><br><span class="line"></span><br><span class="line"># 掐头去尾省略</span><br><span class="line"> &lt;%= excerpt(&quot;西望大家不要再喝完酒后批评别人了&quot;, &quot;喝完酒&quot;, radius: 2) %&gt;</span><br><span class="line"></span><br><span class="line"># 英文复数变形</span><br><span class="line">&lt;%= pluralize(1, &apos;person&apos;) %&gt; # =&gt; 1 person</span><br><span class="line">&lt;%= pluralize(2, &apos;person&apos;) %&gt; # =&gt; 2 people</span><br></pre></td></tr></table></figure>
<h2 id="数值相关"><a href="#数值相关" class="headerlink" title="数值相关"></a>数值相关</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 货币</span><br><span class="line"></span><br><span class="line">&lt;%= number_to_currency( 1234.56  ) %&gt; #=&gt; $1,234.56 </span><br><span class="line">&lt;%= number_to_currency( 1234.56, unit: &quot;¥&quot;, precision: 0  ) %&gt; #=&gt; ¥1,235</span><br><span class="line"></span><br><span class="line"># Byte</span><br><span class="line">&lt;%= number_to_human_size( 1200  ) %&gt; #=&gt; 1.17 KB</span><br><span class="line"></span><br><span class="line"># 百分数</span><br><span class="line">&lt;%= number_to_percentage( 66.666666, precision: 1  ) %&gt; #=&gt; 66.7%</span><br><span class="line"></span><br><span class="line"># 数字3位分割</span><br><span class="line">&lt;%= number_with_delimiter( 1234567890  ) %&gt; #=&gt; 1,234,567,890</span><br><span class="line">&lt;%= number_with_delimiter( 1234567890, delimiter: &quot;_&quot;  ) %&gt; #=&gt; 1_234_567_890</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 四舍五入</span><br><span class="line">&lt;%= number_with_precision( 12.3456, precision: 2  ) %&gt; #=&gt; 12.35</span><br></pre></td></tr></table></figure>
<h2 id="日期时间相关"><a href="#日期时间相关" class="headerlink" title="日期时间相关"></a>日期时间相关</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 从现在开始多久前</span><br><span class="line">&lt;%= time_ago_in_words(3.minutes.from_now)  %&gt;   # =&gt; 3 minutes</span><br><span class="line">&lt;%= time_ago_in_words(3.minutes.ago)  %&gt;            # =&gt; 3 minutes</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/02/17/view-helper/" itemprop="url">
                  Rails中View Helper总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-02-17T09:25:20+08:00" content="2015-02-17">
              2015-02-17
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Rails/" itemprop="url" rel="index">
                    <span itemprop="name">Rails</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/02/17/view-helper/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/02/17/view-helper/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>View Helper提供了form, select, check_box等等一系列的页面元素, 这篇文章进行总结</p>
</blockquote>
<h2 id="超链接-link-to"><a href="#超链接-link-to" class="headerlink" title="超链接(link_to)"></a>超链接(link_to)</h2><h3 id="基本使用方法"><a href="#基本使用方法" class="headerlink" title="基本使用方法"></a>基本使用方法</h3><blockquote>
<p><code>link_to</code>会生成 a 标签</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">link_to(name = nil, options = nil, html_options = nil, &amp;block)</span><br></pre></td></tr></table></figure>
<h4 id="可以指定的options"><a href="#可以指定的options" class="headerlink" title="可以指定的options"></a>可以指定的options</h4><ul>
<li><code>method:</code> 指定<code>:get</code>, ‘:post’, <code>:patch</code>, <code>:delete</code> 代表生成的链接发给服务器的请求使用GET, POST 等HTTP方法.</li>
<li><code>remote: true</code> 像server发送Ajax请求(默认值是false)</li>
<li><code>data: { confirm: &quot;Are you sure to delete?&quot; }</code> 弹出确认对话框</li>
</ul>
<h4 id="link-to经常使用的方法"><a href="#link-to经常使用的方法" class="headerlink" title="link_to经常使用的方法"></a><code>link_to</code>经常使用的方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># HTML属性指定(class)</span><br><span class="line">link_to &quot;Profile&quot;, profile_path(@profile), class: &quot;btn btn-large&quot;, id: &quot;profile#&#123;@profile.id&#125;&quot;</span><br><span class="line">#=&gt; &lt;a class=&quot;btn btn-large&quot; href=&quot;/profiles/1&quot; id=&quot;profiles1&quot;&gt;Profile&lt;/a&gt;</span><br><span class="line"></span><br><span class="line"># 添加查询(?=xxx)</span><br><span class="line">link_to &quot;Profile&quot;, profile_path(@profile, q: &quot;list&quot;)</span><br><span class="line">#=&gt; &lt;a href=&quot;/profiles/1?q=list&quot;&gt;Profile&lt;/a&gt;</span><br><span class="line"></span><br><span class="line"># 指定格式</span><br><span class="line">link_to &quot;Profile&quot;, profile_path(@profile, format: &apos;csv&apos;)</span><br><span class="line"></span><br><span class="line"># 使用block环绕一些元素 </span><br><span class="line"># 这样更加灵活地将链接内容显示在页面</span><br><span class="line">link_to @profile do</span><br><span class="line">  &lt;strong&gt;&lt;%= @profile.name&gt;&lt;/strong&gt; -- &lt;span&gt;Check it out!&lt;/span&gt;</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"># =&gt;  &lt;a href=&quot;/profiles/1&quot;&gt;</span><br><span class="line">        &lt;strong&gt;Daniel&lt;/strong&gt; -- &lt;span&gt;Check it out!&lt;/span&gt;</span><br><span class="line">      &lt;/a&gt;</span><br></pre></td></tr></table></figure>
<h4 id="link-to-if更加条件显示链接"><a href="#link-to-if更加条件显示链接" class="headerlink" title="link_to_if更加条件显示链接"></a><code>link_to_if</code>更加条件显示链接</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">link_to_if(current_user.admin?, &quot;管理员&quot;, admin_path)</span><br></pre></td></tr></table></figure>
<h2 id="img-tag"><a href="#img-tag" class="headerlink" title="img_tag"></a>img_tag</h2><p>###基本使用方法</p>
<blockquote>
<p>生成img 标签, 也就是需要在页面显示图片时使用:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">image_tag(source, options=&#123;&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="Options"><a href="#Options" class="headerlink" title="Options"></a>Options</h3><ul>
<li><p><code>source</code> 表示图片文件的具体位置, 可以使用绝对路径和相对路径, 如果你直接指定文件名, 那么rails会默认去assets/images中寻找该图片文件.</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">例: &lt;%= image_tag &apos;picture.png&apos; %&gt;</span><br><span class="line">#=&gt; &lt;img src=&quot;/images/picture.png&quot; alt=&quot;Picture&quot;&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>alt</code> 加入无法显示图片, alt的文本内容会显示出来.</p>
</li>
<li><code>size</code> 指定图片的长度和高度.</li>
</ul>
<blockquote>
<p>还可以指定html的id属性class属性等等</p>
</blockquote>
<h3 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= image_tag &apos;http://i2.tietuku.com/09b177fc2e10b2dd.png&apos;, alt: &quot;Picture&quot; %&gt;</span><br><span class="line"># =&gt; &lt;img alt=&quot;Picture&quot; src=&quot;http://i2.tietuku.com/09b177fc2e10b2dd.png&quot;&gt;</span><br><span class="line"></span><br><span class="line">image_tag(&quot;picture.png&quot;, size: &quot;50x40&quot;, alt: &quot;Home Image&quot;)</span><br><span class="line"># =&gt; &lt;img src=&quot;/images/picture.png&quot; width=&quot;50&quot; height=&quot;40&quot; alt=&quot;Home Image&quot; /&gt;</span><br><span class="line"></span><br><span class="line">image_tag(&quot;/gallery/picture.png&quot;, size: &quot;200&quot;)</span><br><span class="line"># =&gt; &lt;img src=&quot;/gallery/picture.png&quot; width=&quot;200&quot; height=&quot;200&quot; alt=&quot;Picture&quot; /&gt;</span><br><span class="line"></span><br><span class="line">image_tag(&quot;picture.png&quot;, class: &quot;menu_img&quot;)</span><br><span class="line"># =&gt; &lt;img alt=&quot;Picture&quot; class=&quot;main_img&quot; src=&quot;/images/picture.png&quot; /&gt;</span><br></pre></td></tr></table></figure>
<h2 id="FORM-form-for-form-tag"><a href="#FORM-form-for-form-tag" class="headerlink" title="FORM - form_for form_tag"></a>FORM - <code>form_for</code> <code>form_tag</code></h2><h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><ul>
<li><code>form_for</code> : 我们在创建或者更新Model时, 需要生成依附于这样的Model的表单, 这时使用<code>form_for</code>, 由于表单依附于Model实体, 当发生验证错误时候, 我们可以将错误消息和错误的具体位置在页面表示出来</li>
<li><code>form_tag</code> : 只是单纯地输出表单, 比如我们可以要搜索, 需要提交表单给一个Controller的某个action.不依附于Model, 所以也就进行validation.(可以先这么理解, 我以后写一篇文章介绍两者区别), 其block内部需要使用<code>label_tag</code>这样的xxx_tag方法来生成表单元素<br>&gt;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">form_for(record, options = &#123;&#125; &amp;block)</span><br><span class="line">form_tag(url_for_options = &#123;&#125;&lt; options = &#123;&#125;, &amp;block)</span><br></pre></td></tr></table></figure>
<h3 id="Option"><a href="#Option" class="headerlink" title="Option"></a>Option</h3><ul>
<li><code>url</code> 指提交到的那个url, 对于<code>form_for</code>, 由于Model会自动生成URL, 所以此项不是必须的; 对于<code>form_tag</code>来说, 是必须指定的, 当然, 也可以通过<code>controller</code>, <code>action</code>间接指定url.</li>
<li><code>method</code> 指定HTTP方法, 类似于<code>link_to</code></li>
<li><code>remote</code> Ajax相关, 设置true后, 会通过Ajax来submit.</li>
<li><code>html</code> 指定form的HTML属性, <code>class</code>, <code>role</code>等<blockquote>
</blockquote>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= form_for @user, remote: true, :html =&gt; &#123; :class =&gt; &quot;form-horizontal&quot;, :role =&gt; &quot;form&quot;  &#125; do |f| %&gt;</span><br><span class="line"></span><br><span class="line">  # 指定user的属性</span><br><span class="line">  &lt;%= f.text_field :name %&gt;</span><br><span class="line">  &lt;%= f.number_field :age %&gt;</span><br><span class="line"></span><br><span class="line">  &lt;%= f.submit %&gt;</span><br><span class="line">&lt;% end %&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果需要嵌套Model:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># config/routes.rb</span><br><span class="line"># resources :users do</span><br><span class="line">    resources :comments</span><br><span class="line"># end</span><br><span class="line"></span><br><span class="line"># 需要给form_for 方法传入数组</span><br><span class="line"></span><br><span class="line">&lt;%= form_for [@users, @comments] do |f| %&gt;</span><br><span class="line">  &lt;%= f.text_field :content %&gt;</span><br><span class="line">&lt;% end %&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>form_tag</code> :</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= form_tag(:action =&gt; &quot;create&quot;) do%&gt;</span><br><span class="line">  &lt;div class=&quot;field&quot;&gt;</span><br><span class="line">  &lt;%= label_tag &apos;title&apos; %&gt;</span><br><span class="line">  &lt;%= text_field_tag &apos;title&apos; %&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;div class=&quot;field&quot;&gt;</span><br><span class="line">  &lt;%= label_tag &apos;content&apos; %&gt;</span><br><span class="line">  &lt;%= text_field_tag &apos;content&apos; %&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;div class=&quot;actions&quot;&gt;</span><br><span class="line">  &lt;%= submit_tag &quot;作成&quot; %&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;% end %&gt;</span><br></pre></td></tr></table></figure>
<h2 id="嵌套其他Model的表单fields-for"><a href="#嵌套其他Model的表单fields-for" class="headerlink" title="嵌套其他Model的表单fields_for"></a>嵌套其他Model的表单<code>fields_for</code></h2><blockquote>
<p>如果在Model中使用<code>has_one``has_many</code>去关联其他的Model, 那么在页面表单中就需要使用<code>fields_for</code>来关联这些来自于其他Model的字段, 下面例子说明了在表单中如何把Address的字段嵌入User.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= form_for @user do |f| %&gt;</span><br><span class="line">  &lt;%= f.fields_for :address do |address_fields| %&gt;</span><br><span class="line">    Street: &lt;%= address_fields.text_field :street %&gt;</span><br><span class="line">    Zip Code: &lt;%= address_fields.text_field :zip_code %&gt;</span><br><span class="line">  &lt;% end %&gt;</span><br><span class="line">&lt;% end %&gt;</span><br><span class="line"></span><br><span class="line"># 在 app/models/user.rb中:</span><br><span class="line"></span><br><span class="line">class User &lt; ActiveRecord::Base</span><br><span class="line">  has_many :addresses</span><br><span class="line">  accepts_nested_attributes_for :addresses</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h2 id="生成label的方法-label和label-tag"><a href="#生成label的方法-label和label-tag" class="headerlink" title="生成label的方法 label和label_tag"></a>生成label的方法 <code>label</code>和<code>label_tag</code></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= f.label(:name, &quot;名字&quot;) %&gt;</span><br><span class="line">#=&gt; &lt;label for=&quot;user_name&quot;&gt;名字&lt;/label&gt;</span><br><span class="line"></span><br><span class="line">&lt;%= label_for(:user, &quot;名字&quot;) %&gt;</span><br><span class="line">#=&gt; &lt;label for=&quot;user&quot;&gt;姓名&lt;/label&gt;</span><br></pre></td></tr></table></figure>
<h2 id="文本框-text-field和text-field-tag"><a href="#文本框-text-field和text-field-tag" class="headerlink" title="文本框- text_field和text_field_tag"></a>文本框- <code>text_field</code>和<code>text_field_tag</code></h2><blockquote>
<p>在页面上生成文本输入框, <code>&lt;input type=&quot;text&quot;&gt;</code></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= f.text_field :name %&gt;</span><br><span class="line">#=&gt; &lt;input type=&quot;text&quot; name=&quot;user[name]&quot; id=&quot;user_name&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;%= text_field_tag &quot;user[name]&quot;, &quot;值&quot; %&gt;</span><br><span class="line">#=&gt; &lt;input type=&quot;text&quot; name=&quot;user[name]&quot; id=&quot;user_name&quot; value=&quot;值&quot;&gt;</span><br></pre></td></tr></table></figure>
<h3 id="Option-1"><a href="#Option-1" class="headerlink" title="Option"></a>Option</h3><ul>
<li><code>:disabled</code> : true代表文本框变灰不可以输入</li>
<li><code>:size</code> 设定文本框的长度</li>
<li><code>:maxlength</code> 可以输入的最多字数</li>
<li><code>:placeholder</code> 页面被加载后自动出现在输入框中的文字, 用户输入时会消失</li>
<li>其他一些html的属性</li>
</ul>
<h3 id="一些其他类型的输入框"><a href="#一些其他类型的输入框" class="headerlink" title="一些其他类型的输入框"></a>一些其他类型的输入框</h3><ul>
<li><code>email_field / email_field_tag</code></li>
<li><code>password_field / password_field_tag</code></li>
<li><code>search_field / search_field_tag</code></li>
<li><code>number_field / number_field_tag</code></li>
</ul>
<h3 id="输入日期时间-date-field-time-field-datetime-field"><a href="#输入日期时间-date-field-time-field-datetime-field" class="headerlink" title="输入日期时间- date_field/time_field/datetime_field"></a>输入日期时间- <code>date_field/time_field/datetime_field</code></h3><blockquote>
<p>效果如下:<br><img src="http://i2.tietuku.com/f2f5d504930df9cf.png" alt=""></p>
</blockquote>
<h3 id="选择日期时间-date-select-time-select-datetime-select"><a href="#选择日期时间-date-select-time-select-datetime-select" class="headerlink" title="选择日期时间 - date_select / time_select / datetime_select"></a>选择日期时间 - <code>date_select / time_select / datetime_select</code></h3><p><img src="http://i2.tietuku.com/884bd4cc71002787.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= f.time_select :updated_at %&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>对应的HTML:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=&quot;hidden&quot; id=&quot;profile_updated_at_1i&quot; name=&quot;profile[updated_at(1i)]&quot; value=&quot;2015&quot; /&gt;</span><br><span class="line">&lt;input type=&quot;hidden&quot; id=&quot;profile_updated_at_2i&quot; name=&quot;profile[updated_at(2i)]&quot; value=&quot;2&quot; /&gt;</span><br><span class="line">&lt;input type=&quot;hidden&quot; id=&quot;profile_updated_at_3i&quot; name=&quot;profile[updated_at(3i)]&quot; value=&quot;17&quot; /&gt;</span><br><span class="line">&lt;select id=&quot;profile_updated_at_4i&quot; name=&quot;profile[updated_at(4i)]&quot;&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>submit后, 封装在params中:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Parameters: &#123;&quot;utf8&quot;=&gt;&quot;✓&quot;,</span><br><span class="line">&quot;authenticity_token&quot;=&gt;&quot;WJhATdPc1LEzIpL9r1KG15uYp9TGKdZHV0oYFNjz8jHHDuyn4uuV4do0/7EumsNwHHzuUzt/5Ip5eXpzivxywg==&quot;,</span><br><span class="line">&quot;profile&quot;=&gt;&#123;&quot;updated_at(1i)&quot;=&gt;&quot;2015&quot;, &quot;updated_at(2i)&quot;=&gt;&quot;2&quot;, &quot;updated_at(3i)&quot;=&gt;&quot;17&quot;, &quot;updated_at(4i)&quot;=&gt;&quot;06&quot;, &quot;updated_at(5i)&quot;=&gt;&quot;53&quot;&#125;,</span><br><span class="line">&quot;commit&quot;=&gt;&quot;Create Profile&quot;&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意, 虽然在页面上没有选择年月日, 但是不难看出在HTML源码和params中都有看到年月日一并在发送给了server.如果我指定<code>ignore_date: true</code>, 那么年月日就不会发送给server. 如果没有年月日就会发生异常, 所以, 必须有<code>date_select</code>在表单中.<br><code>date_select</code>和<code>date_time_select</code>道理相同, 我就不一一说明了</p>
</blockquote>
<h2 id="文件上传-file-field-file-field-tag"><a href="#文件上传-file-field-file-field-tag" class="headerlink" title="文件上传- file_field/file_field_tag"></a>文件上传- <code>file_field/file_field_tag</code></h2><p><img src="http://i2.tietuku.com/f2d00300cacb6914.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> # 对于form_tag提交的表单, 需要设置multipart: true, form_for则不需要</span><br><span class="line">&lt;%= form_tag &apos;/upload&apos;, multipart: true do %&gt;</span><br><span class="line">  &lt;label for=&quot;file&quot;&gt;File to Upload&lt;/label&gt; &lt;%= file_field_tag &quot;file&quot; %&gt;</span><br><span class="line">    &lt;%= submit_tag %&gt;</span><br><span class="line">&lt;% end %&gt;</span><br></pre></td></tr></table></figure>
<h2 id="text-area-text-area-tag"><a href="#text-area-text-area-tag" class="headerlink" title="text_area / text_area_tag"></a><code>text_area / text_area_tag</code></h2><blockquote>
<p>该标签对应的Model的属性类型是text</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= text_area_tag &quot;post[content]&quot;, &quot;很长的文章&quot;, size: &quot;200x200&quot; %&gt;</span><br><span class="line">#=&gt; &lt;textarea name=&quot;post[content]&quot; id=&quot;post_content&quot; cols=&quot;200&quot; rows=&quot;200&quot;&gt;很长的文章&lt;/textarea&gt;</span><br></pre></td></tr></table></figure>
<h2 id="下拉列表-select-select-tag-collection-select"><a href="#下拉列表-select-select-tag-collection-select" class="headerlink" title="下拉列表 select / select_tag / collection_select"></a>下拉列表 <code>select / select_tag / collection_select</code></h2><blockquote>
<p>一下三种方法产生的页面效果是一样的:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= f.select :prefecture_id, Prefecture.all.map &#123; |p| [p.name, p.id]  &#125; %&gt;</span><br><span class="line">&lt;%= select_tag &quot;address[prefeture_id]&quot;, options_from_collection_for_select(Prefecture.all, :id, :name) %&gt;</span><br><span class="line">&lt;%= f.collection_select :prefecture_id, Prefecture.all, :id, :name %&gt;</span><br><span class="line"></span><br><span class="line"># =&gt;</span><br><span class="line"># &lt;select name=&quot;address[prefecture_id]&quot; id=&quot;address_prefecture_id&quot;&gt;</span><br><span class="line">#   &lt;option value=&quot;1&quot;&gt;北京&lt;/option&gt;</span><br><span class="line">#   &lt;option value=&quot;2&quot;&gt;上海&lt;/option&gt;</span><br><span class="line">#   &lt;option value=&quot;3&quot;&gt;哈尔滨&lt;/option&gt;</span><br><span class="line"># &lt;/select&gt;</span><br></pre></td></tr></table></figure>
<h2 id="check-box-check-box-tag-collection-check-boxes"><a href="#check-box-check-box-tag-collection-check-boxes" class="headerlink" title="check_box / check_box_tag / collection_check_boxes"></a><code>check_box / check_box_tag / collection_check_boxes</code></h2><h3 id="一个check-box"><a href="#一个check-box" class="headerlink" title="一个check_box"></a>一个check_box</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= f.label :remember_me, &quot;REMEMBER_ME&quot; %&gt;</span><br><span class="line">&lt;%= f.check_box :remember_me %&gt;</span><br><span class="line"></span><br><span class="line"># =&gt; </span><br><span class="line"># &lt;label for=&quot;profile_remember_me&quot;&gt;REMEMBER_ME&lt;/label&gt;</span><br><span class="line"># &lt;input type=&quot;checkbox&quot; value=&quot;1&quot; name=&quot;profile[remember_me]&quot; id=&quot;profile_remember_me&quot;&gt;</span><br><span class="line">    </span><br><span class="line"># OR</span><br><span class="line"></span><br><span class="line">&lt;%= check_box_tag &quot;profile[remember_me]&quot;%&gt;</span><br><span class="line">&lt;%= label_tag &quot;profile[remember_me]&quot;, &quot;记住我&quot; %&gt;</span><br></pre></td></tr></table></figure>
<h3 id="多个-check-box"><a href="#多个-check-box" class="headerlink" title="多个 check_box"></a>多个 check_box</h3><blockquote>
<p>Category和Product 有多对多的关系</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;% Category.all.each do |category| %&gt;</span><br><span class="line">  &lt;%= check_box_tag &quot;product[category_ids][]&quot;, category.id, @product.categories.include?(category), id: &quot;product_category_ids_#&#123;category.id&#125;&quot; %&gt;</span><br><span class="line">    &lt;%= label_tag &quot;product[category_ids][#&#123;category.id&#125;]&quot;, category.name %&gt;</span><br><span class="line">&lt;% end %&gt;</span><br><span class="line"></span><br><span class="line">#=&gt; </span><br><span class="line">&lt;div class=&quot;field&quot;&gt;</span><br><span class="line">&lt;input type=&quot;checkbox&quot; name=&quot;product[category_ids][]&quot; id=&quot;product_category_ids_1&quot; value=&quot;1&quot; checked=&quot;checked&quot; /&gt;</span><br><span class="line">&lt;label for=&quot;Category_0&quot;&gt;Category#0&lt;/label&gt;</span><br><span class="line">&lt;input type=&quot;checkbox&quot; name=&quot;product[category_ids][]&quot; id=&quot;product_category_ids_2&quot; value=&quot;2&quot; checked=&quot;checked&quot; /&gt;</span><br><span class="line">&lt;label for=&quot;Category_1&quot;&gt;Category#1&lt;/label&gt;</span><br><span class="line">&lt;input type=&quot;checkbox&quot; name=&quot;product[category_ids][]&quot; id=&quot;product_category_ids_3&quot; value=&quot;3&quot; checked=&quot;checked&quot; /&gt;</span><br><span class="line">&lt;label for=&quot;Category_2&quot;&gt;Category#2&lt;/label&gt;</span><br><span class="line">&lt;input type=&quot;checkbox&quot; name=&quot;product[category_ids][]&quot; id=&quot;product_category_ids_4&quot; value=&quot;4&quot; /&gt;</span><br><span class="line">&lt;label for=&quot;Category_3&quot;&gt;Category#3&lt;/label&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>然后我们分析一下提交后params集合的参数情况</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">params</span><br><span class="line"># 选择0个box</span><br><span class="line">&quot;product&quot;=&gt;&#123;&quot;name&quot;=&gt;&quot;&quot;&#125;</span><br><span class="line"># 选择2个</span><br><span class="line">&quot;product&quot;=&gt;&#123;&quot;name&quot;=&gt;&quot;&quot;, category_ids&quot;=&gt;[&quot;1&quot;, &quot;2&quot;]&#125;&quot;&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>还需要注意StrongParameters:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">def product_params</span><br><span class="line">  # 注意category_ids: []</span><br><span class="line">  params.require(:product).permit(:name, category_ids: [])</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Parameter和SQL语句</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Parameters: &#123;&quot;utf8&quot;=&gt;&quot;✓&quot;, &quot;authenticity_token&quot;=&gt;&quot;cGk3YzhN3JGSROg+MKdVFj8hois/WQck5mwop/0j2oTv/5uJCXqdwXtShXKxbxCxuMXrrMIPNenIX0rAryxadw==&quot;, &quot;product&quot;=&gt;&#123;&quot;name&quot;=&gt;&quot;iMac&quot;, &quot;category_ids&quot;=&gt;[&quot;1&quot;, &quot;2&quot;]&#125;, &quot;commit&quot;=&gt;&quot;Create Product&quot;&#125;</span><br><span class="line">  Category Load (0.2ms)  SELECT &quot;categories&quot;.* FROM &quot;categories&quot; WHERE &quot;categories&quot;.&quot;id&quot; IN (1, 2)</span><br><span class="line">  (0.0ms)  begin transaction</span><br><span class="line">  SQL (0.2ms)  INSERT INTO &quot;products&quot; (&quot;name&quot;, &quot;created_at&quot;, &quot;updated_at&quot;) VALUES (?, ?, ?)  [[&quot;name&quot;, &quot;iMac&quot;], [&quot;created_at&quot;, &quot;2015-02-17 10:05:04.921510&quot;], [&quot;updated_at&quot;, &quot;2015-02-17 10:05:04.921510&quot;]]</span><br><span class="line">  SQL (0.1ms)  INSERT INTO &quot;categories_products&quot; (&quot;category_id&quot;, &quot;product_id&quot;) VALUES (?, ?)  [[&quot;category_id&quot;, 1], [&quot;product_id&quot;, 2]]</span><br><span class="line">  SQL (0.0ms)  INSERT INTO &quot;categories_products&quot; (&quot;category_id&quot;, &quot;product_id&quot;) VALUES (?, ?)  [[&quot;category_id&quot;, 2], [&quot;product_id&quot;, 2]]</span><br><span class="line">(0.6ms)  commit transaction</span><br></pre></td></tr></table></figure>
<blockquote>
<p>rails还提供了更为简单的方法:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= f.collection_check_boxes :category_ids, Category.all, :id, :name %&gt;</span><br></pre></td></tr></table></figure>
<h2 id="radio-button-radio-button-tag"><a href="#radio-button-radio-button-tag" class="headerlink" title="radio_button, radio_button_tag"></a><code>radio_button, radio_button_tag</code></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">%= f.label :rate %&gt;&lt;br&gt;</span><br><span class="line">&lt;%= f.radio_button :rate, 1 %&gt; &lt;%= f.label :rate_1, 1 %&gt;</span><br><span class="line">&lt;%= f.radio_button :rate, 2 %&gt; &lt;%= f.label :rate_2, 2 %&gt;</span><br><span class="line">&lt;%= f.radio_button :rate, 3 %&gt; &lt;%= f.label :rate_3, 3 %&gt;</span><br><span class="line">&lt;%= f.radio_button :rate, 4 %&gt; &lt;%= f.label :rate_4, 4 %&gt;</span><br><span class="line">&lt;%= f.radio_button :rate, 5 %&gt; &lt;%= f.label :rate_5, 5 %&gt;</span><br><span class="line"># =&gt;</span><br><span class="line">&lt;label for=&quot;product_rate&quot;&gt;Rate&lt;/label&gt;&lt;br&gt;</span><br><span class="line">&lt;input type=&quot;radio&quot; value=&quot;1&quot; name=&quot;product[rate]&quot; id=&quot;product_rate_1&quot;&gt; &lt;label for=&quot;product_rate_1&quot;&gt;1&lt;/label&gt;</span><br><span class="line">&lt;input type=&quot;radio&quot; value=&quot;2&quot; name=&quot;product[rate]&quot; id=&quot;product_rate_2&quot;&gt; &lt;label for=&quot;product_rate_2&quot;&gt;2&lt;/label&gt;</span><br><span class="line">&lt;input type=&quot;radio&quot; value=&quot;3&quot; name=&quot;product[rate]&quot; id=&quot;product_rate_3&quot;&gt; &lt;label for=&quot;product_rate_3&quot;&gt;3&lt;/label&gt;</span><br><span class="line">&lt;input type=&quot;radio&quot; value=&quot;4&quot; name=&quot;product[rate]&quot; id=&quot;product_rate_4&quot;&gt; &lt;label for=&quot;product_rate_4&quot;&gt;4&lt;/label&gt;</span><br><span class="line">&lt;input type=&quot;radio&quot; value=&quot;5&quot; name=&quot;product[rate]&quot; id=&quot;product_rate_5&quot;&gt; &lt;label for=&quot;product_rate_5&quot;&gt;5&lt;/label&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>同样也有<code>collection_xx</code>版本的方法</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= f.collection_radio_buttons :maker_id, Maker.all, :id, :name %&gt;</span><br></pre></td></tr></table></figure>
<h2 id="hidden-field-hidden-field-tag"><a href="#hidden-field-hidden-field-tag" class="headerlink" title="hidden_field / hidden_field_tag"></a>hidden_field / hidden_field_tag</h2><blockquote>
<p>不显示在页面上, 有些信息没有必要给用户看到</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;%= f.hidden_field :lock_version %&gt;</span><br><span class="line">#=&gt; &lt;input type=&quot;hidden&quot; name=&quot;product[lock_version]&quot; id=&quot;product_lock_version&quot; value=&quot;1&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;%= hidden_field_tag &quot;product[lock_version]&quot;, @product.lock_version %&gt;</span><br><span class="line">#=&gt; &lt;input type=&quot;hidden&quot; name=&quot;product[lock_version]&quot; id=&quot;product_lock_version&quot; value=&quot;1&quot;&gt;</span><br></pre></td></tr></table></figure>
<h2 id="submit-submit-tag"><a href="#submit-submit-tag" class="headerlink" title="submit / submit_tag"></a>submit / submit_tag</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= f.submit &quot;注册&quot; %&gt;</span><br><span class="line">#=&gt; &lt;input type=&quot;submit&quot; name=&quot;commit&quot; value=&quot;注册&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;%= submit_tag &quot;Search&quot; %&gt;</span><br><span class="line">#=&gt; &lt;input type=&quot;submit&quot; name=&quot;commit&quot; value=&quot;Search&quot;&gt;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.png"
               alt="Daniel Zhang" />
          <p class="site-author-name" itemprop="name">Daniel Zhang</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">104</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">104</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Daniel Zhang</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"danielhexo"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  





  
  
  

  

  

</body>
</html>
